import{c as J,r,A as W,R as G,j as e,C as K,h as Q,i as X,k as Y,B as i,q as Z,D,l as k,m as S,n as U,o as T,p as O,I as P}from"./index-DESoNwQK.js";import{B as _}from"./badge-BZPWyFCa.js";import{a as ee,S as ae}from"./views.engine-BIlSqcWn.js";import{T as te}from"./triangle-alert-BoZ10o_d.js";import{C as se}from"./circle-check-CAZPiYe6.js";import"./textarea-1YYYT-yv.js";const ne=J("CalendarPlus",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["path",{d:"M21 13V6a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h8",key:"3spt84"}],["path",{d:"M3 10h18",key:"8toen8"}],["path",{d:"M16 19h6",key:"xwg31i"}],["path",{d:"M19 16v6",key:"tddt3s"}]]),re=[{id:"today",label:"Hoje"},{id:"overdue",label:"Atrasados"},{id:"p0",label:"P0"},{id:"awaiting",label:"Aguardando terceiros"},{id:"noNext",label:"Sem proximo follow-up"}],B={P0:0,P1:1,P2:2,P3:3};function ie(d){return d?d.toLocaleDateString("pt-BR"):"-"}function pe({demands:d,onRefresh:u,onUpdate:j,onContact:E,onEscalate:R,activeViewId:h,onChangeView:w}){const[n,M]=r.useState("today"),[x,v]=r.useState(null),[I,y]=r.useState(!1),[N,f]=r.useState(null),[C,g]=r.useState(null),[l,p]=r.useState({channel:"Email",summary:"",nextFollowUpAt:""}),[b,V]=r.useState("N/A");r.useEffect(()=>{if(!x)return;y(!0);const t=window.setTimeout(()=>y(!1),2600),a=window.setTimeout(()=>v(null),3e3);return()=>{window.clearTimeout(t),window.clearTimeout(a)}},[x]);const o=r.useMemo(()=>W().views.find(a=>a.id===h)??null,[h]),A=r.useMemo(()=>{const t=new Date().toISOString().slice(0,10),a=o?ee(d,o):d;return o?a:a.filter(s=>n==="p0"?s.priority==="P0":n==="awaiting"?s.status==="Aguardando terceiros":n==="overdue"?s.isOverdue:n==="noNext"?!s.nextFollowUpAt:n==="today"?s.nextFollowUpAt?s.nextFollowUpAt.toISOString().slice(0,10)===t:!1:!0).sort((s,c)=>{const m=(B[s.priority]??9)-(B[c.priority]??9);if(m!==0)return m;const F=+!!c.isOverdue-+!!s.isOverdue;if(F!==0)return F;const L=s.nextFollowUpAt?s.nextFollowUpAt.getTime():1/0,$=c.nextFollowUpAt?c.nextFollowUpAt.getTime():1/0;return L-$})},[d,n,o]),z=G.useCallback(()=>{const t=[],a=(s,c,m)=>{t.push({field:s,op:c,value:m})};return n==="p0"&&a("priority","eq","P0"),n==="awaiting"&&a("status","eq","Aguardando terceiros"),n==="overdue"&&a("overdue","eq",!0),n==="noNext"&&a("nextFollowUpAt","isnull"),n==="today"&&a("nextFollowUpAt","today"),{id:"",scope:"demands",name:"Nova view",description:"",filters:t,sort:[{field:"priority",dir:"asc"},{field:"nextFollowUpAt",dir:"asc"}],columns:["priority","status","epic","name","externalOwner","nextFollowUpAt","overdue","impact","financialMonthly","financialOneOff","escalateTo"],isPinned:!0,isDefault:!1}},[n]);async function q(){N&&(await E(N.id,{channel:l.channel,summary:l.summary,nextFollowUpAt:l.nextFollowUpAt?new Date(l.nextFollowUpAt):void 0}),f(null),p({channel:"Email",summary:"",nextFollowUpAt:""}),await u())}async function H(){C&&(await R(C.id,b),g(null),await u())}return e.jsxs(K,{className:"bg-card/70",children:[e.jsxs(Q,{children:[e.jsx(X,{children:"Inbox de Follow-up"}),e.jsx(Y,{children:"Priorize o que exige acao esta semana."}),e.jsx("div",{className:"pt-2",children:e.jsx(ae,{scope:"demands",activeViewId:h,onChangeActive:w,getCurrentDraftView:z})}),e.jsx("div",{className:"flex flex-wrap gap-2 pt-2",children:re.map(t=>e.jsx(i,{size:"sm",variant:n===t.id?"default":"outline",onClick:()=>{o&&(w(null),v("View desativada para aplicar filtros rápidos.")),M(t.id)},disabled:!!o,title:o?"Desative a view para usar filtros rápidos.":void 0,children:t.label},t.id))}),x?e.jsx("div",{className:`mt-2 rounded-md border border-amber-500/40 bg-amber-500/10 px-3 py-2 text-xs text-amber-200 transition-opacity duration-300 ${I?"opacity-100":"opacity-0"}`,children:x}):null]}),e.jsxs(Z,{className:"space-y-3 text-sm",children:[A.length===0?e.jsx("div",{className:"text-muted-foreground",children:"Nenhuma demanda encontrada."}):null,A.map(t=>e.jsx("div",{className:"rounded-lg border border-border/60 bg-background/40 p-4",children:e.jsxs("div",{className:"flex flex-col gap-2 lg:flex-row lg:items-center lg:justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(_,{variant:t.isOverdue?"warning":"secondary",children:t.priority}),e.jsx("span",{className:"text-xs text-muted-foreground",children:t.status})]}),e.jsx("p",{className:"text-sm font-semibold",children:t.name}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Épico: ",t.epic," • Dono externo: ",t.externalOwnerId??"Não definido"]})]}),e.jsxs("div",{className:"grid gap-1 text-xs text-muted-foreground",children:[e.jsxs("p",{children:["Proximo follow-up: ",ie(t.nextFollowUpAt)]}),e.jsxs("p",{children:["Impacto: ",t.impact]}),e.jsxs("p",{children:["Financeiro: R$ ",(t.financialMonthly??0).toLocaleString("pt-BR"),"/mes + R$",(t.financialOneOff??0).toLocaleString("pt-BR")]})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs(D,{children:[e.jsx(k,{asChild:!0,children:e.jsx(i,{size:"sm",variant:"outline",onClick:()=>f(t),children:"Registrar contato"})}),e.jsxs(S,{children:[e.jsxs(U,{children:[e.jsx(T,{children:"Registrar contato"}),e.jsx(O,{children:"Atualize o follow-up e proxima data."})]}),e.jsxs("div",{className:"grid gap-3 text-sm",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx("label",{className:"font-medium",children:"Canal"}),e.jsx("select",{className:"h-10 rounded-md border border-input bg-transparent px-3 text-sm",value:l.channel,onChange:a=>p(s=>({...s,channel:a.target.value})),children:["Email","WhatsApp","Teams","Reunião","Outro"].map(a=>e.jsx("option",{value:a,children:a},a))})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx("label",{className:"font-medium",children:"Resumo"}),e.jsx(P,{value:l.summary,onChange:a=>p(s=>({...s,summary:a.target.value})),placeholder:"Resumo do contato"})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx("label",{className:"font-medium",children:"Proximo follow-up"}),e.jsx(P,{type:"date",value:l.nextFollowUpAt,onChange:a=>p(s=>({...s,nextFollowUpAt:a.target.value}))})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(i,{variant:"outline",onClick:()=>f(null),children:"Cancelar"}),e.jsx(i,{onClick:q,children:"Salvar"})]})]})]})]}),e.jsxs(i,{size:"sm",variant:"outline",onClick:async()=>{const a=new Date;a.setDate(a.getDate()+3),await j(t.id,{nextFollowUpAt:a}),await u()},children:[e.jsx(ne,{className:"mr-2 h-4 w-4"}),"Adiar 3 dias"]}),e.jsxs(D,{children:[e.jsx(k,{asChild:!0,children:e.jsxs(i,{size:"sm",variant:"outline",onClick:()=>g(t),children:[e.jsx(te,{className:"mr-2 h-4 w-4"}),"Escalonar"]})}),e.jsxs(S,{children:[e.jsxs(U,{children:[e.jsx(T,{children:"Escalonar demanda"}),e.jsx(O,{children:"Defina o nivel de escalonamento."})]}),e.jsxs("div",{className:"grid gap-3 text-sm",children:[e.jsx("select",{className:"h-10 rounded-md border border-input bg-transparent px-3 text-sm",value:b,onChange:a=>V(a.target.value),children:["N/A","Eduardo","Diretoria","Financeiro","Jurídico","Fornecedor","Parceiro","Outro"].map(a=>e.jsx("option",{value:a,children:a},a))}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(i,{variant:"outline",onClick:()=>g(null),children:"Cancelar"}),e.jsx(i,{onClick:H,children:"Salvar"})]})]})]})]}),e.jsxs(i,{size:"sm",onClick:async()=>{await j(t.id,{status:"Concluído"}),await u()},children:[e.jsx(se,{className:"mr-2 h-4 w-4"}),"Concluir"]})]})]})},t.id))]})]})}export{pe as Inbox};
