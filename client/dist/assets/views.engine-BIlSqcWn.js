import{r as x,A as F,j as n,B as c,D as C,m as E,n as O,o as I,E as b,I as J,a0 as B,a1 as Q,a2 as U,$ as w,a3 as W,a4 as X}from"./index-DESoNwQK.js";import{B as k}from"./badge-BZPWyFCa.js";import{T as Z}from"./textarea-1YYYT-yv.js";function ee(o){const t=o.filter(a=>a.isPinned),s=o.filter(a=>!a.isPinned);return[...t,...s]}function oe({scope:o,activeViewId:t,onChangeActive:s,getCurrentDraftView:a}){const[d,r]=x.useState(()=>F()),m=x.useMemo(()=>{const e=d.views.filter(l=>l.scope===o);return ee(e)},[d.views,o]),[h,i]=x.useState(!1),[u,f]=x.useState(!1),[P,T]=x.useState(""),[_,v]=x.useState(!1),[g,z]=x.useState(null),[D,N]=x.useState(""),[y,S]=x.useState(""),p=m.find(e=>e.id===t)??null;function j(){r(F())}function q(e){B(o,e),s(e),j()}function V(e){w({...e,isPinned:!e.isPinned,isDefault:!!e.isDefault}),j()}function $(e){W(e.id),t===e.id&&s(null),j()}function L(){if(!a)return;const e=a(),l=`v_custom_${Date.now()}`;z(l),N(e.name||"Nova view"),S(e.description||""),v(!0)}function M(e){if(e.isDefault){const l=`v_custom_${Date.now()}`;w({...e,id:l,name:`${e.name} (cÃ³pia)`,isDefault:!1,isPinned:!0,updatedAt:new Date().toISOString()}),B(o,l),s(l),j();return}z(e.id),N(e.name),S(e.description||""),v(!0)}function R(){if(!g)return;const e=d.views.find(l=>l.id===g);if(e)w({...e,name:D.trim()||e.name,description:y.trim(),updatedAt:new Date().toISOString()});else{if(!a)return;const l=a();w({...l,id:g,scope:o,name:D.trim()||"Nova view",description:y.trim(),isDefault:!1,isPinned:!0,updatedAt:new Date().toISOString()})}v(!1),j()}async function A(e){await navigator.clipboard.writeText(e)}async function Y(){const e=Q();await A(e)}async function H(e){const l=JSON.stringify(e,null,2);await A(l)}function G(){try{X(P),T(""),f(!1),j()}catch(e){alert(e?.message??"Falha ao importar JSON.")}}function K(){U(),s("v_overdue"),j()}return n.jsxs("div",{className:"flex flex-col gap-2",children:[n.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[m.map(e=>{const l=e.id===t;return n.jsxs(c,{variant:l?"default":"secondary",size:"sm",onClick:()=>q(e.id),className:"gap-2",title:e.description||e.name,children:[n.jsx("span",{className:"truncate max-w-[180px]",children:e.name}),e.isDefault?n.jsx(k,{variant:l?"secondary":"outline",children:"Default"}):n.jsx(k,{variant:l?"secondary":"outline",children:"Custom"}),e.isPinned?n.jsx(k,{variant:l?"secondary":"outline",children:"ðŸ“Œ"}):null]},e.id)}),n.jsx("div",{className:"flex-1"}),a?n.jsx(c,{variant:"outline",size:"sm",onClick:L,children:"Salvar view atual"}):null,n.jsx(c,{variant:"outline",size:"sm",onClick:()=>f(!0),children:"Importar"}),n.jsx(c,{variant:"outline",size:"sm",onClick:async()=>{await Y(),i(!0)},children:"Exportar"}),n.jsx(c,{variant:"destructive",size:"sm",onClick:K,children:"Resetar padrÃµes"})]}),p?n.jsxs("div",{className:"flex flex-wrap items-center gap-2 rounded-md border p-2",children:[n.jsxs("div",{className:"text-sm opacity-80",children:["Ativa: ",n.jsx("span",{className:"font-medium",children:p.name}),p.description?n.jsxs("span",{className:"opacity-70",children:[" â€” ",p.description]}):null]}),n.jsx("div",{className:"flex-1"}),n.jsx(c,{variant:"outline",size:"sm",onClick:()=>M(p),children:p.isDefault?"Clonar":"Editar"}),n.jsx(c,{variant:"outline",size:"sm",onClick:()=>V(p),children:p.isPinned?"Desafixar":"Fixar"}),n.jsx(c,{variant:"outline",size:"sm",onClick:async()=>{await H(p),alert("JSON da view copiado!")},children:"Copiar JSON da view"}),p.isDefault?null:n.jsx(c,{variant:"destructive",size:"sm",onClick:()=>$(p),children:"Apagar"})]}):null,n.jsx(C,{open:h,onOpenChange:i,children:n.jsxs(E,{children:[n.jsx(O,{children:n.jsx(I,{children:"ExportaÃ§Ã£o"})}),n.jsx("p",{className:"text-sm opacity-80",children:"As views foram copiadas para a Ã¡rea de transferÃªncia. Cole onde quiser (backup ou em outro PC)."}),n.jsx(b,{children:n.jsx(c,{onClick:()=>i(!1),children:"Fechar"})})]})}),n.jsx(C,{open:u,onOpenChange:f,children:n.jsxs(E,{className:"max-w-2xl",children:[n.jsx(O,{children:n.jsx(I,{children:"Importar views"})}),n.jsx("p",{className:"text-sm opacity-80",children:"Cole aqui o JSON exportado (estado inteiro) para adicionar views custom."}),n.jsx(Z,{value:P,onChange:e=>T(e.target.value),placeholder:"Cole o JSON aqui...",className:"min-h-[220px]"}),n.jsxs(b,{children:[n.jsx(c,{variant:"secondary",onClick:()=>f(!1),children:"Cancelar"}),n.jsx(c,{onClick:G,children:"Importar"})]})]})}),n.jsx(C,{open:_,onOpenChange:v,children:n.jsxs(E,{className:"max-w-lg",children:[n.jsx(O,{children:n.jsx(I,{children:d.views.some(e=>e.id===g)?"Editar view":"Salvar nova view"})}),n.jsxs("div",{className:"grid gap-3",children:[n.jsxs("div",{className:"grid gap-1",children:[n.jsx("label",{className:"text-sm opacity-80",children:"Nome"}),n.jsx(J,{value:D,onChange:e=>N(e.target.value)})]}),n.jsxs("div",{className:"grid gap-1",children:[n.jsx("label",{className:"text-sm opacity-80",children:"DescriÃ§Ã£o (opcional)"}),n.jsx(J,{value:y,onChange:e=>S(e.target.value)})]})]}),n.jsxs(b,{children:[n.jsx(c,{variant:"secondary",onClick:()=>v(!1),children:"Cancelar"}),n.jsx(c,{onClick:R,children:"Salvar"})]})]})})]})}const ne=(o,t)=>o.getFullYear()===t.getFullYear()&&o.getMonth()===t.getMonth()&&o.getDate()===t.getDate();function ae(o,t){const s=t.field,a=t.op;return o.filter(d=>{const r=d[s];if(a==="eq")return r===t.value;if(a==="ne")return r!==t.value;if(a==="in")return Array.isArray(t.value)&&t.value.includes(r);if(a==="contains")return String(r??"").toLowerCase().includes(String(t.value??"").toLowerCase());if(a==="isnull")return r==null||r==="";if(a==="isnotnull")return!(r==null||r==="");if(a==="today"){if(!r)return!1;const m=new Date(r);return ne(m,new Date)}if(a==="between"){if(!r||!t.value||typeof t.value!="object")return!1;const{from:m,to:h}=t.value,i=new Date(r).getTime(),u=m?new Date(m).getTime():-1/0,f=h?new Date(h).getTime():1/0;return i>=u&&i<=f}return!0})}function te(o,t,s){const a=o[s.field],d=t[s.field];if(s.field==="priority"){const i={P0:0,P1:1,P2:2,P3:3},u=i[a]??99,f=i[d]??99;return s.dir==="asc"?u-f:f-u}if(s.field==="overdue"){const i=a?1:0,u=d?1:0;return s.dir==="asc"?i-u:u-i}const r=i=>{if(i instanceof Date)return i.getTime();if(typeof i=="number")return i;if(typeof i=="string"){const u=Date.parse(i);return Number.isNaN(u)?i.toLowerCase():u}return typeof i=="boolean"?i?1:0:i??""},m=r(a),h=r(d);return m<h?s.dir==="asc"?-1:1:m>h?s.dir==="asc"?1:-1:0}function le(o,t){let s=[...o];return t.filters.forEach(a=>s=ae(s,a)),t.sort.forEach(a=>s.sort((d,r)=>te(d,r,a))),s}export{oe as S,le as a};
