import{r as a,j as s,I as f}from"./index-DESoNwQK.js";function j(r){return Number.isNaN(r.getTime())?"-":r.toLocaleString("pt-BR")}function v({demands:r}){const[l,c]=a.useState("all"),[n,m]=a.useState("all"),[i,u]=a.useState(""),o=a.useMemo(()=>r.flatMap(e=>(e.audits??[]).map(t=>({...t,demandId:e.id,demandName:e.name}))).sort((e,t)=>t.at.getTime()-e.at.getTime()),[r]),x=a.useMemo(()=>Array.from(new Set(o.map(e=>e.actor))).filter(Boolean),[o]),p=a.useMemo(()=>Array.from(new Set(o.map(e=>e.action))).filter(Boolean),[o]),d=o.filter(e=>{const t=l==="all"||e.actor===l,h=n==="all"||e.action===n,g=e.demandName.toLowerCase().includes(i.toLowerCase())||(e.field??"").toLowerCase().includes(i.toLowerCase());return t&&h&&g});return s.jsxs("div",{className:"grid gap-4",children:[s.jsxs("div",{className:"grid gap-3 text-sm lg:grid-cols-3",children:[s.jsx(f,{value:i,onChange:e=>u(e.target.value),placeholder:"Buscar por demanda ou campo"}),s.jsxs("select",{className:"h-10 rounded-md border border-input bg-transparent px-3 text-sm",value:l,onChange:e=>c(e.target.value),children:[s.jsx("option",{value:"all",children:"Todos os atores"}),x.map(e=>s.jsx("option",{value:e,children:e},e))]}),s.jsxs("select",{className:"h-10 rounded-md border border-input bg-transparent px-3 text-sm",value:n,onChange:e=>m(e.target.value),children:[s.jsx("option",{value:"all",children:"Todas as acoes"}),p.map(e=>s.jsx("option",{value:e,children:e},e))]})]}),d.length===0?s.jsx("div",{className:"text-sm text-muted-foreground",children:"Nenhuma auditoria registrada."}):null,d.map((e,t)=>s.jsxs("div",{className:"rounded-lg border border-border/60 bg-card/70 p-4",children:[s.jsxs("div",{className:"flex items-start justify-between gap-4",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-xs text-muted-foreground",children:j(e.at)}),s.jsx("p",{className:"text-sm font-semibold",children:e.demandName})]}),s.jsx("span",{className:"text-xs text-muted-foreground",children:e.actor})]}),s.jsxs("div",{className:"mt-3 text-sm text-muted-foreground",children:[s.jsxs("p",{children:["Acao: ",e.action]}),e.field?s.jsxs("p",{children:["Campo: ",e.field]}):null,e.before?s.jsxs("p",{children:["Antes: ",e.before]}):null,e.after?s.jsxs("p",{children:["Depois: ",e.after]}):null,e.notes?s.jsxs("p",{children:["Notas: ",e.notes]}):null]})]},`${e.at}-${t}`))]})}export{v as AuditLog};
