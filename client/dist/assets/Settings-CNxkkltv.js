import{c as te,r as n,K as he,j as e,C as E,h as D,i as U,q as M,B as c,L as pe,D as q,m as B,n as V,o as W,I as t,E as Q,M as ge,N as je,O as ve,P as fe,Q as be,S as Ne,T as Se,U as ye,V as Pe,W as de,k as G,X as L}from"./index-DESoNwQK.js";import{T as me,a as xe,b as _,c as X}from"./tabs-OU8pq1yq.js";import{T as ae}from"./textarea-1YYYT-yv.js";import{L as R,S as Ce}from"./label-BvjkKViM.js";import{B as oe}from"./badge-BZPWyFCa.js";import{P as ce}from"./plus-DdIgbnXm.js";import{T as we}from"./trash-2-LwTOdgcj.js";const Ae=te("Pen",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]]);const re=te("Shield",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]]);const Ie=te("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]),ne=[{key:"tickets",label:"Chamados",actions:["view","create","edit","delete"]},{key:"demands",label:"Demandas",actions:["view","create","edit","delete"]},{key:"assets",label:"Ativos",actions:["view","create","edit","delete"]},{key:"contracts",label:"Contratos",actions:["view","create","edit","delete"]},{key:"users",label:"Usuários",actions:["view","manage"]},{key:"reports",label:"Relatórios",actions:["view"]},{key:"settings",label:"Configurações",actions:["manage"]}],ie=()=>{const m={};return ne.forEach(i=>{m[i.key]={},i.actions.forEach(S=>{m[i.key][S]=!1})}),m},Ee=m=>{const i=ie();return m&&ne.forEach(S=>{S.actions.forEach(d=>{const o=m?.[S.key]?.[d];typeof o=="boolean"&&(i[S.key][d]=o)})}),i};function Me({token:m}){const[i,S]=n.useState("users"),[d,o]=n.useState([]),[k,C]=n.useState([]),[z,y]=n.useState(null),[$,b]=n.useState(null),[H,g]=n.useState(!1),[F,T]=n.useState("create"),[h,N]=n.useState({id:"",name:"",email:"",profileId:"",isActive:!0}),[l,x]=n.useState(null),[j,v]=n.useState(!1),[u,P]=n.useState({id:"",name:"",description:"",isSystem:!1,permissions:ie()}),w=u.isSystem&&u.name.trim().toLowerCase()==="administrador";n.useEffect(()=>{m&&he(m).then(r=>C(r)).catch(()=>C([]))},[m]);const A=async()=>{if(m)try{const r=await ge(m);o(r)}catch{o([])}};n.useEffect(()=>{A()},[m]);const f=n.useMemo(()=>{const r=new Map;return d.forEach(s=>{r.set(s.id,s.name)}),r},[d]),I=()=>{T("create"),N({id:"",name:"",email:"",profileId:"",isActive:!0}),x(null),g(!0)},J=r=>{T("edit");const s=typeof r.profile=="string"?r.profile:r.profile?.id??"";N({id:r.id,name:r.name,email:r.email,profileId:s,isActive:r.isActive}),x(null),g(!0)},O=async()=>{if(m){if(!h.name.trim()||!h.email.trim()||!h.profileId){y("Preencha todos os campos obrigatórios.");return}try{if(F==="create"){const r=await ve(m,{name:h.name.trim(),email:h.email.trim(),profileId:h.profileId});C(s=>[r.user,...s]),x(r.tempPassword),y("Usuário criado com sucesso.")}else{const r=await fe(m,h.id,{name:h.name.trim(),profileId:h.profileId,isActive:h.isActive});C(s=>s.map(a=>a.id===r.id?r:a)),y("Usuário atualizado."),g(!1)}}catch(r){y(r?.message??"Falha ao salvar usuário.")}}},Y=()=>{P({id:"",name:"",description:"",isSystem:!1,permissions:ie()}),b(null),v(!0)},K=r=>{P({...r,permissions:Ee(r.permissions)}),b(null),v(!0)},Z=(r,s)=>{P(a=>({...a,permissions:{...a.permissions,[r]:{...a.permissions[r],[s]:!a.permissions[r]?.[s]}}}))},ee=async()=>{if(m){if(!u.name.trim()){b("Informe o nome do perfil.");return}try{if(u.id){const r=await be(m,u.id,{name:u.name.trim(),description:u.description?.trim()??"",permissions:u.permissions});o(s=>s.map(a=>a.id===r.id?r:a)),b("Perfil atualizado.")}else{const r=await Ne(m,{name:u.name.trim(),description:u.description?.trim()??"",permissions:u.permissions});o(s=>[r,...s]),b("Perfil criado.")}v(!1)}catch(r){b(r?.message??"Falha ao salvar perfil.")}}},se=async r=>{if(m&&r&&confirm("Tem certeza que deseja excluir este perfil?"))try{await je(m,r),o(s=>s.filter(a=>(a._id||a.id)!==r)),b("Perfil removido.")}catch(s){console.error("Erro ao deletar:",s),b(s?.message??"Falha ao remover perfil."),alert(s?.message||"Erro ao excluir perfil"),A()}};return e.jsxs(E,{className:"bg-card/70 lg:col-span-12",children:[e.jsx(D,{className:"flex flex-col gap-3 lg:flex-row lg:items-center lg:justify-between",children:e.jsxs("div",{children:[e.jsx(U,{children:"Controle de Acesso"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Gerencie usuários e perfis com permissão granular."})]})}),e.jsx(M,{children:e.jsxs(me,{value:i,onValueChange:S,children:[e.jsxs(xe,{className:"grid w-full max-w-[420px] grid-cols-2",children:[e.jsx(_,{value:"users",children:"Usuários"}),e.jsx(_,{value:"profiles",children:"Perfis de Acesso"})]}),e.jsxs(X,{value:"users",className:"mt-6 space-y-4",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(Ie,{className:"h-4 w-4"}),k.length," usuário(s)"]}),e.jsxs(c,{onClick:I,children:[e.jsx(ce,{className:"mr-2 h-4 w-4"}),"Novo usuário"]})]}),z?e.jsx("p",{className:"text-xs text-amber-300",children:z}):null,k.length===0?e.jsx("div",{className:"rounded-lg border border-dashed border-border/60 p-6 text-sm text-muted-foreground",children:"Nenhum usuário cadastrado."}):e.jsx("div",{className:"grid gap-3",children:k.map(r=>e.jsxs("div",{className:"rounded-lg border border-border/60 bg-background/40 p-4",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-foreground",children:r.name}),e.jsx("p",{className:"text-xs text-muted-foreground",children:r.email})]}),e.jsx("div",{className:"text-xs",children:typeof r.profile=="string"?f.get(r.profile)??"Sem perfil":r.profile?.name??"Sem perfil"})]}),e.jsxs("div",{className:"mt-2 text-xs text-muted-foreground",children:["Status: ",r.isActive?"Ativo":"Inativo",r.mustChangePassword?" • Trocar senha":""]}),e.jsxs("div",{className:"mt-3 flex flex-wrap gap-2",children:[e.jsx(c,{size:"sm",variant:"outline",onClick:()=>J(r),children:"Editar"}),e.jsx(c,{size:"sm",variant:"outline",onClick:async()=>{if(m)try{const s=await pe(m,r.id);C(a=>a.map(p=>p.id===s.user.id?s.user:p)),x(s.tempPassword),y("Senha temporária gerada."),g(!0),T("edit"),N({id:s.user.id,name:s.user.name,email:s.user.email,profileId:typeof s.user.profile=="string"?s.user.profile:s.user.profile?.id??"",isActive:s.user.isActive})}catch(s){y(s?.message??"Falha ao resetar senha.")}},children:"Resetar senha"})]})]},r.id))})]}),e.jsxs(X,{value:"profiles",className:"mt-6 space-y-4",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(re,{className:"h-4 w-4"}),d.length," perfil(is)"]}),e.jsxs(c,{onClick:Y,children:[e.jsx(ce,{className:"mr-2 h-4 w-4"}),"Criar novo perfil"]})]}),$?e.jsx("p",{className:"text-xs text-amber-300",children:$}):null,d.length===0?e.jsx("div",{className:"rounded-lg border border-dashed border-border/60 p-6 text-sm text-muted-foreground",children:"Nenhum perfil cadastrado."}):e.jsx("div",{className:"grid gap-4 md:grid-cols-2 xl:grid-cols-3",children:d.map(r=>{const s=r.isSystem&&r.name==="Administrador";return e.jsx(E,{className:"border-border/60 bg-background/40",children:e.jsxs(M,{className:"space-y-3 p-4",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(re,{className:"h-4 w-4 text-primary"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-foreground",children:r.name}),r.description?e.jsx("p",{className:"text-xs text-muted-foreground",children:r.description}):null]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[s?null:e.jsx(c,{size:"icon",variant:"ghost",onClick:()=>K(r),children:e.jsx(Ae,{className:"h-4 w-4"})}),r.isSystem?null:e.jsx(c,{size:"icon",variant:"ghost",className:"text-destructive",onClick:()=>se(r._id||r.id),children:e.jsx(we,{className:"h-4 w-4"})})]})]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:r.isSystem?e.jsx(oe,{variant:"secondary",children:"Sistema"}):e.jsx(oe,{variant:"outline",children:"Personalizado"})}),s?null:e.jsx(c,{size:"sm",variant:"outline",onClick:()=>K(r),children:"Configurar permissões"})]})},r.id)})})]})]})}),e.jsx(q,{open:H,onOpenChange:g,children:e.jsxs(B,{className:"max-w-xl",children:[e.jsx(V,{children:e.jsx(W,{children:F==="create"?"Novo usuário":"Editar usuário"})}),e.jsxs("div",{className:"grid gap-3 text-sm text-muted-foreground",children:[e.jsxs("div",{className:"grid gap-1",children:[e.jsx(R,{children:"Nome"}),e.jsx(t,{value:h.name,onChange:r=>N(s=>({...s,name:r.target.value}))})]}),e.jsxs("div",{className:"grid gap-1",children:[e.jsx(R,{children:"E-mail"}),e.jsx(t,{value:h.email,onChange:r=>N(s=>({...s,email:r.target.value})),disabled:F==="edit"})]}),e.jsxs("div",{className:"grid gap-1",children:[e.jsx(R,{children:"Perfil"}),e.jsxs("select",{className:"h-10 rounded-md border border-input bg-transparent px-3 text-sm",value:h.profileId,onChange:r=>N(s=>({...s,profileId:r.target.value})),children:[e.jsx("option",{value:"",children:"Selecione um perfil"}),d.map(r=>e.jsx("option",{value:r.id,children:r.name},r.id))]})]}),e.jsxs("div",{className:"grid gap-1",children:[e.jsx(R,{children:"Status"}),e.jsxs("select",{className:"h-10 rounded-md border border-input bg-transparent px-3 text-sm",value:h.isActive?"true":"false",onChange:r=>N(s=>({...s,isActive:r.target.value==="true"})),children:[e.jsx("option",{value:"true",children:"Ativo"}),e.jsx("option",{value:"false",children:"Inativo"})]})]}),l?e.jsxs("div",{className:"rounded-md border border-amber-500/40 bg-amber-500/10 p-3 text-xs text-amber-200",children:["Senha temporária: ",e.jsx("span",{className:"font-semibold",children:l})]}):null]}),e.jsxs(Q,{children:[e.jsx(c,{variant:"secondary",onClick:()=>g(!1),children:"Cancelar"}),e.jsx(c,{onClick:O,children:"Salvar"})]})]})}),e.jsx(q,{open:j,onOpenChange:v,children:e.jsxs(B,{className:"max-w-3xl",children:[e.jsx(V,{children:e.jsx(W,{children:u.id?"Editar perfil":"Novo perfil de acesso"})}),w?e.jsx("div",{className:"rounded-md border-l-4 border-amber-500 bg-amber-50 p-4 text-sm text-amber-800 dark:bg-amber-900/20 dark:text-amber-200",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(re,{className:"mt-0.5 h-4 w-4 text-amber-500"}),e.jsxs("p",{children:[e.jsx("strong",{children:"Perfil de sistema protegido:"})," o Administrador possui acesso total irrestrito. As permissões não podem ser removidas."]})]})}):null,e.jsxs("div",{className:"grid gap-4",children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("div",{className:"grid gap-1",children:[e.jsx(R,{children:"Nome do perfil"}),e.jsx(t,{value:u.name,onChange:r=>P(s=>({...s,name:r.target.value})),disabled:w})]}),e.jsxs("div",{className:"grid gap-1",children:[e.jsx(R,{children:"Descrição"}),e.jsx(t,{value:u.description??"",onChange:r=>P(s=>({...s,description:r.target.value}))})]})]}),e.jsx("div",{className:"overflow-hidden rounded-lg border border-border/60",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{className:"bg-muted/50 text-muted-foreground",children:e.jsxs("tr",{children:[e.jsx("th",{className:"p-3 text-left font-medium",children:"Módulo"}),e.jsx("th",{className:"p-3 text-center",children:"Visualizar"}),e.jsx("th",{className:"p-3 text-center",children:"Criar"}),e.jsx("th",{className:"p-3 text-center",children:"Editar"}),e.jsx("th",{className:"p-3 text-center",children:"Excluir/Gerir"})]})}),e.jsx("tbody",{className:"divide-y divide-border/60",children:ne.map(r=>e.jsxs("tr",{className:"hover:bg-muted/20",children:[e.jsx("td",{className:"p-3 font-medium",children:r.label}),["view","create","edit","delete"].map(s=>{if(!(r.actions.includes(s)||s==="delete"&&r.actions.includes("manage")))return e.jsx("td",{className:"p-3 text-center text-muted-foreground/30",children:"-"},s);const p=s==="delete"&&r.actions.includes("manage")?"manage":s,ue=w?!0:u.permissions?.[r.key]?.[p]??!1;return e.jsx("td",{className:"p-3 text-center",children:e.jsx("div",{className:"flex justify-center",children:e.jsx(Ce,{checked:ue,onCheckedChange:()=>!w&&Z(r.key,p),disabled:w,className:w?"cursor-not-allowed opacity-50 data-[state=checked]:bg-emerald-500":""})})},s)})]},r.key))})]})})]}),e.jsxs(Q,{children:[e.jsx(c,{variant:"outline",onClick:()=>v(!1),children:"Cancelar"}),e.jsx(c,{onClick:ee,children:"Salvar perfil"})]})]})})]})}const le={id:"",enabled:!1,provider:"Gmail",emailAddress:"",imapHost:"imap.gmail.com",imapPort:993,imapTls:!0,mailbox:"INBOX",pollingIntervalMin:5,defaultQueue:"TI Interna",defaultStatus:"Novo",defaultImpact:"Médio",defaultUrgency:"Média",defaultSystem:"Email",defaultCategory:"Suporte",defaultExternalOwnerId:"",hasPassword:!1};function Re({notifications:m=[],token:i,externalParties:S=[]}){const[d,o]=n.useState(le),[k,C]=n.useState(""),[z,y]=n.useState(null),[$,b]=n.useState(!1),[H,g]=n.useState(null),[F,T]=n.useState(!1),[h,N]=n.useState(null),[l,x]=n.useState({id:"",mailProvider:"Gmail",fromName:"WayTI Control",fromEmail:"",gmailUser:"",hasGmailPassword:!1,hasSendGridKey:!1,office365User:"",hasOffice365Password:!1,sesRegion:"us-east-1",sesSmtpUser:"",hasSesPassword:!1,mailgunDomain:"",hasMailgunKey:!1,smtpHost:"",smtpPort:587,smtpSecure:!1,smtpUser:"",hasSmtpPassword:!1,slaWarningMinutes:120,slaPolicies:{urgentHours:8,highHours:48,mediumHours:120,lowHours:240},emailSignature:"",cannedResponses:[]}),[j,v]=n.useState({gmailAppPassword:"",sendGridApiKey:"",office365Pass:"",sesSmtpPass:"",mailgunApiKey:"",smtpPass:""}),[u,P]=n.useState([]),[w,A]=n.useState(!1),[f,I]=n.useState({id:"",title:"",body:"",scope:"shared"}),[J,O]=n.useState(null),[Y,K]=n.useState({urgentHours:8,highHours:48,mediumHours:120,lowHours:240}),[Z,ee]=n.useState(null),[se,r]=n.useState("");return n.useEffect(()=>{i&&Se(i).then(s=>o({...le,...s})).catch(()=>o(le))},[i]),n.useEffect(()=>{i&&ye(i).then(s=>{x(a=>({...a,...s})),Array.isArray(s.cannedResponses)&&P(s.cannedResponses),s.slaPolicies&&K({urgentHours:s.slaPolicies.urgentHours??8,highHours:s.slaPolicies.highHours??48,mediumHours:s.slaPolicies.mediumHours??120,lowHours:s.slaPolicies.lowHours??240}),typeof s.emailSignature=="string"&&r(s.emailSignature)}).catch(()=>{})},[i]),e.jsxs("div",{className:"grid gap-6 lg:grid-cols-12",children:[e.jsx(q,{open:$,onOpenChange:b,children:e.jsxs(B,{className:"max-w-3xl",children:[e.jsx(V,{children:e.jsx(W,{children:"Integração de Chamados"})}),e.jsxs("div",{className:"space-y-4 text-sm text-muted-foreground",children:[e.jsx("div",{className:"grid gap-3 lg:grid-cols-2",children:e.jsxs("div",{className:"grid gap-1",children:[e.jsx("label",{children:"Provedor de recebimento"}),e.jsxs("select",{className:"h-10 rounded-md border border-input bg-transparent px-3 text-sm",value:d.provider??"Gmail",onChange:s=>{const a=s.target.value;o(a==="Gmail"?p=>({...p,provider:a,imapHost:"imap.gmail.com",imapPort:993,imapTls:!0}):a==="Office365"?p=>({...p,provider:a,imapHost:"outlook.office365.com",imapPort:993,imapTls:!0}):p=>({...p,provider:a}))},children:[e.jsx("option",{value:"Gmail",children:"Gmail"}),e.jsx("option",{value:"Office365",children:"Office365"}),e.jsx("option",{value:"IMAP",children:"IMAP genérico"})]})]})}),e.jsxs("div",{className:"grid gap-3 lg:grid-cols-2",children:[e.jsxs("div",{className:"grid gap-1",children:[e.jsx("label",{children:"E-mail do provedor"}),e.jsx(t,{value:d.emailAddress,onChange:s=>o(a=>({...a,emailAddress:s.target.value})),placeholder:"nome@gmail.com"})]}),e.jsxs("div",{className:"grid gap-1",children:[e.jsx("label",{children:"Senha do provedor (App Password ou IMAP)"}),e.jsx(t,{type:"password",value:k,onChange:s=>C(s.target.value),placeholder:d.hasPassword?"Senha já configurada":"Cole aqui"})]})]}),e.jsxs("div",{className:"grid gap-3 lg:grid-cols-3",children:[e.jsxs("div",{className:"grid gap-1",children:[e.jsx("label",{children:"Servidor IMAP"}),e.jsx(t,{value:d.imapHost,onChange:s=>o(a=>({...a,imapHost:s.target.value}))})]}),e.jsxs("div",{className:"grid gap-1",children:[e.jsx("label",{children:"Porta"}),e.jsx(t,{type:"number",value:d.imapPort,onChange:s=>o(a=>({...a,imapPort:Number(s.target.value)}))})]}),e.jsxs("div",{className:"grid gap-1",children:[e.jsx("label",{children:"Caixa"}),e.jsx(t,{value:d.mailbox,onChange:s=>o(a=>({...a,mailbox:s.target.value}))})]})]}),e.jsxs("div",{className:"grid gap-3 lg:grid-cols-3",children:[e.jsxs("div",{className:"grid gap-1",children:[e.jsx("label",{children:"Intervalo (min)"}),e.jsx(t,{type:"number",value:d.pollingIntervalMin,onChange:s=>o(a=>({...a,pollingIntervalMin:Number(s.target.value)}))})]}),e.jsxs("div",{className:"grid gap-1",children:[e.jsx("label",{children:"Fila padrão"}),e.jsxs("select",{className:"h-10 rounded-md border border-input bg-transparent px-3 text-sm",value:d.defaultQueue,onChange:s=>o(a=>({...a,defaultQueue:s.target.value})),children:[e.jsx("option",{value:"TI Interna",children:"TI Interna"}),e.jsx("option",{value:"Fornecedor",children:"Fornecedor"})]})]}),e.jsxs("div",{className:"grid gap-1",children:[e.jsx("label",{children:"Fornecedor padrão (opcional)"}),e.jsxs("select",{className:"h-10 rounded-md border border-input bg-transparent px-3 text-sm",value:d.defaultExternalOwnerId??"",onChange:s=>o(a=>({...a,defaultExternalOwnerId:s.target.value})),children:[e.jsx("option",{value:"",children:"Não definido"}),S.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})]})]}),e.jsxs("div",{className:"grid gap-3 lg:grid-cols-3",children:[e.jsxs("div",{className:"grid gap-1",children:[e.jsx("label",{children:"Sistema padrão"}),e.jsx(t,{value:d.defaultSystem,onChange:s=>o(a=>({...a,defaultSystem:s.target.value}))})]}),e.jsxs("div",{className:"grid gap-1",children:[e.jsx("label",{children:"Categoria padrão"}),e.jsx(t,{value:d.defaultCategory,onChange:s=>o(a=>({...a,defaultCategory:s.target.value}))})]}),e.jsxs("div",{className:"grid gap-1",children:[e.jsx("label",{children:"Status inicial"}),e.jsx("select",{className:"h-10 rounded-md border border-input bg-transparent px-3 text-sm",value:d.defaultStatus,onChange:s=>o(a=>({...a,defaultStatus:s.target.value})),children:["Novo","Triagem","Em atendimento","Aguardando fornecedor","Aguardando solicitante"].map(s=>e.jsx("option",{value:s,children:s},s))})]})]}),e.jsxs("div",{className:"grid gap-3 lg:grid-cols-3",children:[e.jsxs("div",{className:"grid gap-1",children:[e.jsx("label",{children:"Impacto padrão"}),e.jsx("select",{className:"h-10 rounded-md border border-input bg-transparent px-3 text-sm",value:d.defaultImpact,onChange:s=>o(a=>({...a,defaultImpact:s.target.value})),children:["Baixo","Médio","Alto"].map(s=>e.jsx("option",{value:s,children:s},s))})]}),e.jsxs("div",{className:"grid gap-1",children:[e.jsx("label",{children:"Urgência padrão"}),e.jsx("select",{className:"h-10 rounded-md border border-input bg-transparent px-3 text-sm",value:d.defaultUrgency,onChange:s=>o(a=>({...a,defaultUrgency:s.target.value})),children:["Baixa","Média","Alta"].map(s=>e.jsx("option",{value:s,children:s},s))})]}),e.jsxs("div",{className:"grid gap-1",children:[e.jsx("label",{children:"Ativar integração"}),e.jsxs("select",{className:"h-10 rounded-md border border-input bg-transparent px-3 text-sm",value:d.enabled?"true":"false",onChange:s=>o(a=>({...a,enabled:s.target.value==="true"})),children:[e.jsx("option",{value:"true",children:"Ativo"}),e.jsx("option",{value:"false",children:"Inativo"})]})]})]}),e.jsxs("div",{className:"grid gap-1",children:[e.jsx("label",{children:"Notas internas (opcional)"}),e.jsx(ae,{placeholder:"Ex: Caixa exclusiva para chamados, sem anexos grandes."})]}),z?e.jsx("p",{className:"text-xs text-emerald-300",children:z}):null,H?e.jsx("p",{className:"text-xs text-amber-300",children:H}):null,e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx(c,{onClick:async()=>{if(i)try{const s=await Pe(i,{...d,appPassword:k||void 0});o({...d,...s}),C(""),y("Configuração salva com sucesso."),g(null)}catch{y("Não foi possível salvar a configuração.")}},children:"Salvar configuração"}),e.jsx(c,{variant:"outline",onClick:async()=>{if(i)try{g("Testando conexão..."),await de(i),g("Conexão IMAP validada com sucesso.")}catch(s){g(s?.message??"Falha ao testar conexão.")}},children:"Testar conexão"}),e.jsx(c,{variant:"secondary",onClick:()=>b(!1),children:"Fechar"})]})]}),e.jsx(Q,{})]})}),e.jsx("div",{className:"lg:col-span-12",children:e.jsxs(me,{defaultValue:"canned",className:"grid gap-4",children:[e.jsxs(xe,{className:"flex flex-wrap",children:[e.jsx(_,{value:"canned",children:"Respostas Prontas"}),e.jsx(_,{value:"sla",children:"Políticas de SLA"}),e.jsx(_,{value:"channels",children:"Canais e E-mail"})]}),e.jsx(X,{value:"canned",children:e.jsxs(E,{className:"bg-card/70",children:[e.jsxs(D,{className:"flex flex-col gap-4 lg:flex-row lg:items-center lg:justify-between",children:[e.jsxs("div",{children:[e.jsx(U,{children:"Respostas Prontas"}),e.jsx(G,{children:"Snippets para uso rápido pelos agentes."})]}),e.jsx(c,{onClick:()=>{I({id:"",title:"",body:"",scope:"shared"}),A(!0)},children:"Nova resposta"})]}),e.jsxs(M,{className:"space-y-3 text-sm text-muted-foreground",children:[J?e.jsx("p",{className:"text-xs text-amber-300",children:J}):null,u.length===0?e.jsx("p",{children:"Nenhuma resposta cadastrada."}):u.map(s=>e.jsxs("div",{className:"rounded-lg border border-border/60 bg-background/40 p-4",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-foreground",children:s.title}),e.jsx("p",{className:"text-xs text-muted-foreground",children:s.scope==="shared"?"Compartilhado":"Pessoal"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(c,{size:"sm",variant:"outline",onClick:()=>{I(s),A(!0)},children:"Editar"}),e.jsx(c,{size:"sm",variant:"outline",onClick:async()=>{if(!i)return;const a=u.filter(p=>p.id!==s.id);P(a);try{await L(i,{cannedResponses:a}),O("Resposta removida.")}catch(p){O(p?.message??"Falha ao remover.")}},children:"Remover"})]})]}),e.jsx("p",{className:"mt-2 text-xs text-muted-foreground line-clamp-3",children:s.body})]},s.id))]})]})}),e.jsx(X,{value:"sla",children:e.jsxs(E,{className:"bg-card/70",children:[e.jsxs(D,{children:[e.jsx(U,{children:"Políticas de SLA"}),e.jsx(G,{children:"Defina a janela de vencimento por prioridade."})]}),e.jsxs(M,{className:"space-y-4 text-sm text-muted-foreground",children:[e.jsx("div",{className:"grid gap-3 lg:grid-cols-4",children:[{key:"urgentHours",label:"Urgente (P0)"},{key:"highHours",label:"Alta (P1)"},{key:"mediumHours",label:"Média (P2)"},{key:"lowHours",label:"Baixa (P3)"}].map(s=>e.jsxs("div",{className:"rounded-lg border border-border/60 bg-background/40 p-3",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:s.label}),e.jsx(t,{type:"number",value:Y[s.key],onChange:a=>K(p=>({...p,[s.key]:Number(a.target.value)}))}),e.jsx("p",{className:"mt-1 text-[11px] text-muted-foreground",children:"Horas"})]},s.key))}),Z?e.jsx("p",{className:"text-xs text-amber-300",children:Z}):null,e.jsx(c,{onClick:async()=>{if(i)try{const s=await L(i,{slaPolicies:Y});x(a=>({...a,...s})),ee("Políticas de SLA salvas.")}catch(s){ee(s?.message??"Falha ao salvar políticas.")}},children:"Salvar políticas"})]})]})}),e.jsxs(X,{value:"channels",children:[e.jsxs("div",{className:"grid gap-4 lg:grid-cols-2",children:[e.jsxs(E,{className:"bg-card/70",children:[e.jsxs(D,{children:[e.jsx(U,{children:"Integração IMAP"}),e.jsx(G,{children:"Recebimento de e-mails para abertura de chamados."})]}),e.jsxs(M,{className:"space-y-3 text-sm text-muted-foreground",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Status"}),e.jsx("span",{className:d.enabled&&d.hasPassword?"text-emerald-300":"text-amber-300",children:d.enabled&&d.hasPassword?"Configurado":"Pendente"})]}),H?e.jsx("p",{className:"text-xs text-amber-300",children:H}):null,e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx(c,{size:"sm",onClick:()=>b(!0),children:"Configurar"}),e.jsx(c,{size:"sm",variant:"outline",onClick:async()=>{if(i)try{g("Testando conexão..."),await de(i),g("Conexão IMAP validada com sucesso.")}catch(s){g(s?.message??"Falha ao testar conexão.")}},children:"Testar IMAP"})]})]})]}),e.jsxs(E,{className:"bg-card/70",children:[e.jsxs(D,{children:[e.jsx(U,{children:"Envio SMTP"}),e.jsx(G,{children:"Configuração do serviço de envio."})]}),e.jsxs(M,{className:"space-y-3 text-sm text-muted-foreground",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Status"}),e.jsx("span",{className:l.smtpHost&&l.smtpUser&&l.hasSmtpPassword?"text-emerald-300":"text-amber-300",children:l.smtpHost&&l.smtpUser&&l.hasSmtpPassword?"Configurado":"Pendente"})]}),e.jsx(c,{size:"sm",onClick:()=>T(!0),children:"Configurar envio"})]})]})]}),e.jsxs(E,{className:"mt-4 bg-card/70",children:[e.jsxs(D,{children:[e.jsx(U,{children:"Assinatura Padrão"}),e.jsx(G,{children:"Rodapé aplicado em todos os e-mails enviados."})]}),e.jsxs(M,{className:"space-y-3 text-sm text-muted-foreground",children:[e.jsx(ae,{value:se,onChange:s=>r(s.target.value),placeholder:"Atenciosamente, Equipe de TI"}),e.jsx(c,{onClick:async()=>{if(i)try{const s=await L(i,{emailSignature:se});x(a=>({...a,...s})),N("Assinatura salva.")}catch(s){N(s?.message??"Falha ao salvar assinatura.")}},children:"Salvar assinatura"}),h?e.jsx("p",{className:"text-xs text-amber-300",children:h}):null]})]})]})]})}),e.jsx(Me,{token:i}),e.jsxs(E,{className:"bg-card/70 lg:col-span-12",children:[e.jsxs(D,{children:[e.jsx(U,{children:"Notificações"}),e.jsx(G,{children:"Status enviados por e-mail/Slack (simulado)."})]}),e.jsxs(M,{className:"space-y-3 text-sm text-muted-foreground",children:[m.length===0?e.jsx("p",{children:"Nenhuma notificação enviada ainda."}):null,m.map(s=>e.jsxs("div",{className:"rounded-lg border border-border/60 bg-background/40 p-3",children:[e.jsx("p",{className:"text-xs uppercase text-muted-foreground",children:s.channel}),e.jsx("p",{children:s.message}),e.jsx("p",{className:"text-xs text-muted-foreground",children:new Date(s.createdAt).toLocaleString("pt-BR")})]},s.id))]})]}),e.jsx(q,{open:w,onOpenChange:A,children:e.jsxs(B,{className:"max-w-2xl",children:[e.jsx(V,{children:e.jsx(W,{children:"Resposta pronta"})}),e.jsxs("div",{className:"grid gap-4 text-sm text-muted-foreground",children:[e.jsxs("div",{className:"rounded-lg border border-border/60 bg-background/40 p-3 text-xs text-muted-foreground",children:["Variáveis disponíveis: ","{ticket}",", ","{assunto}",", ","{status}",", ","{prioridade}",","," ","{fila}",", ","{responsavel}",", ","{sistema}",", ","{categoria}"]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx("label",{children:"Título / Atalho"}),e.jsx(t,{value:f.title,onChange:s=>I(a=>({...a,title:s.target.value})),placeholder:"Ex: Atualização padrão"})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx("label",{children:"Disponibilidade"}),e.jsxs("select",{className:"h-10 rounded-md border border-input bg-transparent px-3 text-sm",value:f.scope,onChange:s=>I(a=>({...a,scope:s.target.value})),children:[e.jsx("option",{value:"personal",children:"Pessoal"}),e.jsx("option",{value:"shared",children:"Compartilhado"})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx("label",{children:"Texto da resposta"}),e.jsx(ae,{value:f.body,onChange:s=>I(a=>({...a,body:s.target.value})),placeholder:"Texto que será usado na resposta."})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx(c,{onClick:async()=>{if(!i||!f.title.trim()||!f.body.trim())return;const s=f.id?u.map(a=>a.id===f.id?{...a,...f}:a):[...u,{id:`canned_${Date.now()}`,title:f.title.trim(),body:f.body.trim(),scope:f.scope}];P(s);try{await L(i,{cannedResponses:s}),O("Resposta salva."),A(!1)}catch(a){O(a?.message??"Falha ao salvar resposta.")}},children:"Salvar"}),e.jsx(c,{variant:"outline",onClick:()=>I({id:"",title:"",body:"",scope:"shared"}),children:"Limpar"})]})]}),e.jsx(Q,{children:e.jsx(c,{variant:"secondary",onClick:()=>A(!1),children:"Fechar"})})]})}),e.jsx(q,{open:F,onOpenChange:T,children:e.jsxs(B,{className:"max-w-3xl",children:[e.jsx(V,{children:e.jsx(W,{children:"Parâmetros do Sistema"})}),e.jsxs("div",{className:"grid gap-3 text-sm text-muted-foreground",children:[e.jsxs("div",{className:"grid gap-1",children:[e.jsx("label",{children:"Serviço de envio"}),e.jsxs("select",{className:"h-10 rounded-md border border-input bg-transparent px-3 text-sm",value:l.mailProvider,onChange:s=>x(a=>({...a,mailProvider:s.target.value})),children:[e.jsx("option",{value:"Gmail",children:"Gmail (App Password)"}),e.jsx("option",{value:"Office365",children:"Office365"}),e.jsx("option",{value:"SendGrid",children:"SendGrid"}),e.jsx("option",{value:"AmazonSES",children:"Amazon SES"}),e.jsx("option",{value:"Mailgun",children:"Mailgun"}),e.jsx("option",{value:"SMTP",children:"SMTP da empresa"})]})]}),e.jsxs("div",{className:"grid gap-3 lg:grid-cols-2",children:[e.jsxs("div",{className:"grid gap-1",children:[e.jsx("label",{children:"Nome do remetente"}),e.jsx(t,{value:l.fromName,onChange:s=>x(a=>({...a,fromName:s.target.value}))})]}),e.jsxs("div",{className:"grid gap-1",children:[e.jsx("label",{children:"E-mail do remetente"}),e.jsx(t,{value:l.fromEmail,onChange:s=>x(a=>({...a,fromEmail:s.target.value}))})]})]}),l.mailProvider==="Gmail"?e.jsxs("div",{className:"grid gap-3 lg:grid-cols-2",children:[e.jsxs("div",{className:"grid gap-1",children:[e.jsx("label",{children:"Gmail usuário"}),e.jsx(t,{value:l.gmailUser,onChange:s=>x(a=>({...a,gmailUser:s.target.value}))})]}),e.jsxs("div",{className:"grid gap-1",children:[e.jsx("label",{children:"App Password"}),e.jsx(t,{type:"password",value:j.gmailAppPassword,onChange:s=>v(a=>({...a,gmailAppPassword:s.target.value})),placeholder:l.hasGmailPassword?"Senha já configurada":"Cole aqui"})]})]}):null,l.mailProvider==="Office365"?e.jsxs("div",{className:"grid gap-3 lg:grid-cols-2",children:[e.jsxs("div",{className:"grid gap-1",children:[e.jsx("label",{children:"Usuário Office365"}),e.jsx(t,{value:l.office365User,onChange:s=>x(a=>({...a,office365User:s.target.value}))})]}),e.jsxs("div",{className:"grid gap-1",children:[e.jsx("label",{children:"Senha (App Password)"}),e.jsx(t,{type:"password",value:j.office365Pass,onChange:s=>v(a=>({...a,office365Pass:s.target.value})),placeholder:l.hasOffice365Password?"Senha já configurada":"Cole aqui"})]})]}):null,l.mailProvider==="SendGrid"?e.jsx("div",{className:"grid gap-3 lg:grid-cols-2",children:e.jsxs("div",{className:"grid gap-1",children:[e.jsx("label",{children:"API Key"}),e.jsx(t,{type:"password",value:j.sendGridApiKey,onChange:s=>v(a=>({...a,sendGridApiKey:s.target.value})),placeholder:l.hasSendGridKey?"Chave já configurada":"Cole aqui"})]})}):null,l.mailProvider==="AmazonSES"?e.jsxs("div",{className:"grid gap-3 lg:grid-cols-2",children:[e.jsxs("div",{className:"grid gap-1",children:[e.jsx("label",{children:"Região"}),e.jsx(t,{value:l.sesRegion,onChange:s=>x(a=>({...a,sesRegion:s.target.value}))})]}),e.jsxs("div",{className:"grid gap-1",children:[e.jsx("label",{children:"Usuário SMTP"}),e.jsx(t,{value:l.sesSmtpUser,onChange:s=>x(a=>({...a,sesSmtpUser:s.target.value}))})]}),e.jsxs("div",{className:"grid gap-1",children:[e.jsx("label",{children:"Senha SMTP"}),e.jsx(t,{type:"password",value:j.sesSmtpPass,onChange:s=>v(a=>({...a,sesSmtpPass:s.target.value})),placeholder:l.hasSesPassword?"Senha já configurada":"Cole aqui"})]})]}):null,l.mailProvider==="Mailgun"?e.jsxs("div",{className:"grid gap-3 lg:grid-cols-2",children:[e.jsxs("div",{className:"grid gap-1",children:[e.jsx("label",{children:"Domínio"}),e.jsx(t,{value:l.mailgunDomain,onChange:s=>x(a=>({...a,mailgunDomain:s.target.value}))})]}),e.jsxs("div",{className:"grid gap-1",children:[e.jsx("label",{children:"API Key"}),e.jsx(t,{type:"password",value:j.mailgunApiKey,onChange:s=>v(a=>({...a,mailgunApiKey:s.target.value})),placeholder:l.hasMailgunKey?"Chave já configurada":"Cole aqui"})]})]}):null,l.mailProvider==="SMTP"?e.jsxs("div",{className:"grid gap-3 lg:grid-cols-2",children:[e.jsxs("div",{className:"grid gap-1",children:[e.jsx("label",{children:"Host SMTP"}),e.jsx(t,{value:l.smtpHost,onChange:s=>x(a=>({...a,smtpHost:s.target.value}))})]}),e.jsxs("div",{className:"grid gap-1",children:[e.jsx("label",{children:"Porta"}),e.jsx(t,{type:"number",value:l.smtpPort,onChange:s=>x(a=>({...a,smtpPort:Number(s.target.value)}))})]}),e.jsxs("div",{className:"grid gap-1",children:[e.jsx("label",{children:"Usuário SMTP"}),e.jsx(t,{value:l.smtpUser,onChange:s=>x(a=>({...a,smtpUser:s.target.value}))})]}),e.jsxs("div",{className:"grid gap-1",children:[e.jsx("label",{children:"Senha SMTP"}),e.jsx(t,{type:"password",value:j.smtpPass,onChange:s=>v(a=>({...a,smtpPass:s.target.value})),placeholder:l.hasSmtpPassword?"Senha já configurada":"Cole aqui"})]}),e.jsxs("div",{className:"grid gap-1",children:[e.jsx("label",{children:"Conexão segura (TLS)"}),e.jsxs("select",{className:"h-10 rounded-md border border-input bg-transparent px-3 text-sm",value:l.smtpSecure?"true":"false",onChange:s=>x(a=>({...a,smtpSecure:s.target.value==="true"})),children:[e.jsx("option",{value:"true",children:"Sim"}),e.jsx("option",{value:"false",children:"Não"})]})]})]}):null,e.jsxs("div",{className:"grid gap-3 lg:grid-cols-2",children:[e.jsxs("div",{className:"grid gap-1",children:[e.jsx("label",{children:"Alerta de SLA (minutos)"}),e.jsx(t,{type:"number",min:5,value:l.slaWarningMinutes??120,onChange:s=>x(a=>({...a,slaWarningMinutes:Number(s.target.value||120)}))})]}),e.jsxs("div",{className:"grid gap-1",children:[e.jsx("label",{children:"Descrição"}),e.jsx(t,{value:"Notificação visual antes do SLA estourar.",disabled:!0})]})]}),h?e.jsx("p",{className:"text-xs text-amber-300",children:h}):null]}),e.jsxs(Q,{children:[e.jsx(c,{variant:"secondary",onClick:()=>T(!1),children:"Fechar"}),e.jsx(c,{onClick:async()=>{if(i)try{const s=await L(i,{...l,gmailAppPassword:j.gmailAppPassword||void 0,sendGridApiKey:j.sendGridApiKey||void 0,office365Pass:j.office365Pass||void 0,sesSmtpPass:j.sesSmtpPass||void 0,mailgunApiKey:j.mailgunApiKey||void 0,smtpPass:j.smtpPass||void 0});x(a=>({...a,...s})),v({gmailAppPassword:"",sendGridApiKey:"",office365Pass:"",sesSmtpPass:"",mailgunApiKey:"",smtpPass:""}),N("Parâmetros salvos.")}catch(s){N(s?.message??"Falha ao salvar parâmetros.")}},children:"Salvar"})]})]})})]})}export{Re as Settings};
