import{c as D,r as c,j as e,C as y,h as k,i as I,k as U,D as S,l as M,B as i,m as E,n as F,o as T,p as B,I as x,q as O}from"./index-DESoNwQK.js";import{B as R}from"./badge-BZPWyFCa.js";import{P as V}from"./plus-DdIgbnXm.js";import{C as z}from"./circle-check-CAZPiYe6.js";import{C as A}from"./clock-q8ic_tsl.js";const H=D("CalendarClock",[["path",{d:"M21 7.5V6a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h3.5",key:"1osxxc"}],["path",{d:"M16 2v4",key:"4m81vk"}],["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M3 10h5",key:"r794hk"}],["path",{d:"M17.5 17.5 16 16.3V14",key:"akvzfd"}],["circle",{cx:"16",cy:"16",r:"6",key:"qoo3c4"}]]),q={aberto:{label:"Aberto",icon:A,tone:"secondary"},"em-validacao":{label:"Em validacao",icon:H,tone:"warning"},feito:{label:"Concluido",icon:z,tone:"success"}};function v(){return new Date().toISOString().slice(0,10)}function w(n){return new Date(`${n}T00:00:00`)}function K({demands:n,onUpdate:u}){const[C,p]=c.useState(!1),[h,g]=c.useState(null),[o,r]=c.useState({demandId:n[0]?.id??"",title:"",owner:"",dueDate:v()}),f=c.useMemo(()=>n.flatMap(a=>a.followUps.map(s=>({...s,demandId:a.id,demandName:a.name}))),[n]);async function N(){const a=n.find(t=>t.id===o.demandId);if(!a){g("Selecione uma demanda valida.");return}const s={id:`FU-${Math.floor(Math.random()*900+100)}`,title:o.title,owner:o.owner,dueDate:w(o.dueDate),status:"aberto",notes:"Criado manualmente."},d=await u(a.id,{followUps:[s,...a.followUps],lastUpdate:new Date});if(!d.ok){g(d.message??"Falha ao criar follow-up.");return}p(!1),r({demandId:a.id,title:"",owner:"",dueDate:v()})}async function j(a,s,d){const t=n.find(l=>l.id===a);if(!t)return;const m=t.followUps.map(l=>l.id===s?{...l,status:d}:l);await u(a,{followUps:m,lastUpdate:new Date})}async function b(a,s,d){const t=n.find(l=>l.id===a);if(!t)return;const m=t.followUps.map(l=>l.id===s?{...l,dueDate:w(d),status:"em-validacao"}:l);await u(a,{followUps:m,lastUpdate:new Date})}return e.jsxs(y,{className:"bg-card/70",children:[e.jsx(k,{children:e.jsxs("div",{className:"flex items-start justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx(I,{children:"Agenda de Follow-ups"}),e.jsx(U,{children:"Controle diario de pendencias, aprovacoes e entregas."})]}),e.jsxs(S,{open:C,onOpenChange:p,children:[e.jsx(M,{asChild:!0,children:e.jsxs(i,{className:"gap-2",children:[e.jsx(V,{className:"h-4 w-4"}),"Novo follow-up"]})}),e.jsxs(E,{children:[e.jsxs(F,{children:[e.jsx(T,{children:"Novo follow-up"}),e.jsx(B,{children:"Vincule o follow-up a uma demanda ativa."})]}),e.jsxs("div",{className:"grid gap-3 text-sm",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx("label",{className:"font-medium",children:"Demanda"}),e.jsx("select",{className:"h-10 rounded-md border border-input bg-transparent px-3 text-sm",value:o.demandId,onChange:a=>r(s=>({...s,demandId:a.target.value})),children:n.map(a=>e.jsx("option",{value:a.id,children:a.name},a.id))})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx("label",{className:"font-medium",children:"Titulo"}),e.jsx(x,{value:o.title,onChange:a=>r(s=>({...s,title:a.target.value})),placeholder:"Validar aprovacao do fornecedor"})]}),e.jsxs("div",{className:"grid gap-2 lg:grid-cols-2",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx("label",{className:"font-medium",children:"Responsavel"}),e.jsx(x,{value:o.owner,onChange:a=>r(s=>({...s,owner:a.target.value})),placeholder:"Nome do responsavel"})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx("label",{className:"font-medium",children:"Entrega"}),e.jsx(x,{type:"date",value:o.dueDate,onChange:a=>r(s=>({...s,dueDate:a.target.value}))})]})]}),h?e.jsx("p",{className:"text-sm text-destructive",children:h}):null,e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(i,{variant:"outline",onClick:()=>p(!1),children:"Cancelar"}),e.jsx(i,{onClick:N,children:"Salvar"})]})]})]})]})]})}),e.jsxs(O,{className:"space-y-4",children:[f.length===0?e.jsx("div",{className:"text-sm text-muted-foreground",children:"Nenhum follow-up cadastrado."}):null,f.map(a=>{const s=q[a.status],d=s.icon;return e.jsxs("div",{className:"flex flex-col gap-2 rounded-lg border border-border/60 bg-background/40 p-4 lg:flex-row lg:items-center lg:justify-between",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(d,{className:"h-4 w-4 text-primary"}),e.jsx("p",{className:"text-sm font-semibold",children:a.title})]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[a.demandName," â€¢ Responsavel: ",a.owner]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3 text-xs text-muted-foreground",children:[e.jsxs("label",{className:"flex items-center gap-2",children:["Entrega",e.jsx("input",{className:"rounded-md border border-input bg-transparent px-2 py-1",type:"date",value:a.dueDate.toISOString().slice(0,10),onChange:t=>b(a.demandId,a.id,t.target.value)})]}),e.jsx(R,{variant:s.tone,children:s.label}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(i,{size:"sm",variant:"outline",onClick:()=>j(a.demandId,a.id,"em-validacao"),children:"Em validacao"}),e.jsx(i,{size:"sm",onClick:()=>j(a.demandId,a.id,"feito"),children:"Concluir"})]})]})]},a.id)})]})]})}export{K as FollowUps};
