import{c as oe,r,A as ks,j as e,C as Hs,h as Ws,i as _s,k as Js,B as l,I as z,q as Qs,D as b,m as y,n as N,o as w,E,U as Qa,Y as ls,Z as Ka,_ as Ks,$ as is,a0 as Xs}from"./index-DESoNwQK.js";import{B as F}from"./badge-BZPWyFCa.js";import{T as Xa,a as Ga,b as te,c as le}from"./tabs-OU8pq1yq.js";import{T as ie}from"./textarea-1YYYT-yv.js";import{a as Za,S as Ya}from"./views.engine-BIlSqcWn.js";import{C as Ua}from"./clock-q8ic_tsl.js";import{T as en}from"./triangle-alert-BoZ10o_d.js";const sn=oe("Bolt",[["path",{d:"M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z",key:"yt0hxn"}],["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}]]);const an=oe("Flag",[["path",{d:"M4 15s1-1 4-1 5 2 8 2 4-1 4-1V3s-1 1-4 1-5-2-8-2-4 1-4 1z",key:"i9b6wo"}],["line",{x1:"4",x2:"4",y1:"22",y2:"15",key:"1cm3nv"}]]);const nn=oe("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]);const rn=oe("Paperclip",[["path",{d:"M13.234 20.252 21 12.3",key:"1cbrk9"}],["path",{d:"m16 6-8.414 8.586a2 2 0 0 0 0 2.828 2 2 0 0 0 2.828 0l8.414-8.586a4 4 0 0 0 0-5.656 4 4 0 0 0-5.656 0l-8.415 8.585a6 6 0 1 0 8.486 8.486",key:"1pkts6"}]]);const tn=oe("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]),ln=[{id:"open",label:"Abertos"},{id:"triage",label:"Triagem"},{id:"approvals",label:"AprovaÃ§Ãµes"},{id:"overdue",label:"Atrasados"},{id:"risk",label:"Risco 48h"},{id:"waitingVendor",label:"Aguardando fornecedor"},{id:"unlinked",label:"Sem vÃ­nculo"}],os={Novo:"secondary",Triagem:"warning","Em atendimento":"default","Aguardando fornecedor":"warning","Aguardando solicitante":"secondary","Aguardando aprovaÃ§Ã£o":"warning",Resolvido:"success",Fechado:"outline",Cancelado:"outline"},Gs={Email:"default",Portal:"secondary",Telefone:"outline",WhatsApp:"secondary",Chat:"default",Manual:"outline"};function Re(d){if(!d)return"NA";const m=d.trim().split(/\s+/);return m.length===1?m[0].slice(0,2).toUpperCase():`${m[0][0]}${m[m.length-1][0]}`.toUpperCase()}function de(d,m){const p={"{ticket}":m.code,"{assunto}":m.subject,"{status}":m.status,"{prioridade}":m.priority,"{fila}":m.queue,"{responsavel}":m.assignee??"NÃ£o atribuÃ­do","{sistema}":m.system,"{categoria}":m.category};return Object.keys(p).reduce((C,$)=>C.split($).join(p[$]),d)}function dn(d){const m=Date.now()-d.getTime(),p=Math.floor(m/(1e3*60));if(p<1)return"agora";if(p<60)return`hÃ¡ ${p} min`;const C=Math.floor(p/60);return C<24?`hÃ¡ ${C} h`:`hÃ¡ ${Math.floor(C/24)} d`}const P=[{id:"slaDueAt",label:"SLA",width:"120px",render:d=>d.slaDueAt?e.jsx(F,{variant:d.isSlaOverdue?"warning":"outline",children:d.slaDueAt.toLocaleDateString("pt-BR")}):e.jsx(F,{variant:"outline",children:"Sem SLA"})},{id:"subject",label:"Chamado",width:"1.6fr",required:!0,render:d=>e.jsxs("div",{children:[e.jsxs("p",{className:"text-sm font-semibold text-foreground",children:[d.code," â€¢ ",d.subject]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Sistema: ",d.system||"-"," â€¢ Categoria: ",d.category||"-"]}),e.jsxs("div",{className:"mt-1 flex flex-wrap items-center gap-2 text-xs text-muted-foreground",children:[e.jsx(F,{variant:Gs[d.channel??"Manual"],children:d.channel??"Manual"}),e.jsxs("span",{children:["Demanda: ",d.demandId??"NÃ£o vinculado"]})]})]})},{id:"channel",label:"Canal",width:"0.7fr",render:d=>e.jsx(F,{variant:Gs[d.channel??"Manual"],children:d.channel??"Manual"})},{id:"queue",label:"Fila",width:"0.8fr",render:d=>e.jsx("div",{className:"text-xs",children:e.jsx("span",{className:"font-medium text-foreground",children:d.queue})})},{id:"status",label:"SituaÃ§Ã£o",width:"0.8fr",render:d=>e.jsx(F,{variant:os[d.status],children:d.status})},{id:"priority",label:"Prioridade",width:"0.7fr",render:d=>e.jsx(F,{variant:d.priority==="P0"?"warning":"outline",children:d.priority})},{id:"openedAt",label:"Abertura",width:"0.8fr",render:d=>e.jsx("span",{className:"text-xs text-muted-foreground",children:d.openedAt.toLocaleDateString("pt-BR")})},{id:"system",label:"Sistema",width:"0.8fr",render:d=>e.jsx("span",{className:"text-xs",children:d.system||"-"})},{id:"assignee",label:"ResponsÃ¡vel",width:"0.8fr",render:d=>e.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[e.jsx("span",{className:"flex h-7 w-7 items-center justify-center rounded-full bg-muted text-[10px] font-semibold text-foreground",children:Re(d.assignee)}),e.jsx("span",{children:d.assignee??"Sem responsÃ¡vel"})]})},{id:"demandId",label:"VÃ­nculo",width:"0.9fr",render:d=>e.jsx("span",{className:"text-xs",children:d.demandId??"NÃ£o vinculado"})}],ds=P.map(d=>d.id);function fn({token:d,currentUser:m,tickets:p,activeViewId:C,onChangeView:$,demands:ze,externalParties:Ee,assets:k,onUpdateTicket:S,onCreateTicket:Zs,onAddComment:cs,onLinkDemand:Ys,onDeleteTicket:Us,onApproveTicket:ea,onRejectTicket:sa}){const[ce,aa]=r.useState("all"),[ue,na]=r.useState("all"),[B,ra]=r.useState("open"),[D,Pe]=r.useState("all"),[me,Fe]=r.useState("all"),[xe,ta]=r.useState(""),[A,L]=r.useState(null),[M,Be]=r.useState(new Set),[la,he]=r.useState(!1),[us,ms]=r.useState(""),[ia,pe]=r.useState(!1),[$e,Le]=r.useState(""),[q,O]=r.useState(""),[Q,xs]=r.useState(""),[qe,da]=r.useState(""),[Ve,oa]=r.useState(""),[ca,ua]=r.useState(!1),[K,hs]=r.useState(""),[ge,fe]=r.useState([]),[ma,ke]=r.useState({}),[xa,ps]=r.useState(!1),[gs,ha]=r.useState(null),[v,fs]=r.useState(null),[js,pa]=r.useState([]),[X,ga]=r.useState(null),[He,fa]=r.useState(Date.now()),[ja,va]=r.useState(120),[je,ba]=r.useState({urgentHours:8,highHours:48,mediumHours:120,lowHours:240}),[vs,ya]=r.useState([]),[G,ve]=r.useState(""),[We,bs]=r.useState("reply"),[_e,Je]=r.useState(""),[Na,be]=r.useState(!1),f=r.useMemo(()=>vs,[vs]),[wa,ye]=r.useState(!1),[Qe,ys]=r.useState(""),[Ca,Z]=r.useState(!1),[Ns,Ke]=r.useState("Triagem"),[Sa,Ne]=r.useState(!1),[Xe,ws]=r.useState(""),[Aa,we]=r.useState(!1),[Cs,Ia]=r.useState("Triagem"),[Ta,Ce]=r.useState(!1),[Se,Ss]=r.useState(""),[Da,Ge]=r.useState(!1),[c,Ze]=r.useState(null),[Ma,Ae]=r.useState(!1),[Ye,Ue]=r.useState(!1),[As,Is]=r.useState("Triagem"),[Ts,Ds]=r.useState("P2"),[Oa,es]=r.useState(!1),[H,Y]=r.useState("all"),[W,Ie]=r.useState(ds),[Te,De]=r.useState([]),[ss,Ra]=r.useState(62),as=r.useRef(null),[u,j]=r.useState({subject:"",description:"",system:"",category:"",impact:"MÃ©dio",urgency:"MÃ©dia",queue:"TI Interna",externalOwnerId:"",channel:"Manual",assignee:"",relatedAssetId:""}),[V,Ms]=r.useState(""),_=r.useMemo(()=>ks().views.find(a=>a.id===C)??null,[C]);r.useEffect(()=>{Y(D==="all"?"all":D)},[D]),r.useEffect(()=>{async function s(){if(d)try{const a=await Qa(d);typeof a.slaWarningMinutes=="number"&&va(a.slaWarningMinutes),a.slaPolicies&&ba({urgentHours:a.slaPolicies.urgentHours??8,highHours:a.slaPolicies.highHours??48,mediumHours:a.slaPolicies.mediumHours??120,lowHours:a.slaPolicies.lowHours??240}),Array.isArray(a.cannedResponses)&&ya(a.cannedResponses)}catch{}}s()},[d]),r.useEffect(()=>{const s=window.setInterval(()=>fa(Date.now()),6e4);return()=>window.clearInterval(s)},[]),r.useEffect(()=>{!f.some(a=>a.id===G)&&f.length>0&&(ve(f[0].id),O(c?de(f[0].body,c):f[0].body))},[f,G,c]),r.useEffect(()=>{f.length&&(G||ve(f[0].id))},[f,G]),r.useEffect(()=>{if(!c)return;const s=p.find(a=>a.id===c.id);s&&Ze(s)},[p,c]),r.useEffect(()=>{c&&(Is(c.status),Ds(c.priority))},[c]),r.useEffect(()=>{async function s(){if(!(!d||!c)){ps(!0);try{const a=await ls(d,c.id);ke(n=>({...n,[c.id]:a.items})),a.lastInboundFrom&&xs(a.lastInboundFrom),hs(`Re: ${c.subject}`)}catch{}finally{ps(!1)}}}s()},[d,c?.id]),r.useEffect(()=>()=>{v?.url&&URL.revokeObjectURL(v.url),js.forEach(s=>URL.revokeObjectURL(s.url))},[v,js]),r.useEffect(()=>{const s=["slaDueAt","subject","queue","status","priority","openedAt"],a=_?.columns?.length?_.columns:s,n=P.filter(o=>o.required).map(o=>o.id),i=[...a,...n.filter(o=>!a.includes(o)),...ds.filter(o=>!a.includes(o)&&!n.includes(o))];De(Array.from(new Set([...a,...n]))),Ie(Array.from(new Set(i)))},[C,_?.columns]);const Os=r.useMemo(()=>{const s=new Set(Te);return W.filter(a=>s.has(a)).map(a=>P.find(n=>n.id===a)).filter(Boolean)},[W,Te]),J=r.useMemo(()=>H==="all"?"tiDemand.ticketColumns.global":`tiDemand.ticketColumns.${H}`,[H]);r.useEffect(()=>{try{const s=localStorage.getItem(J);if(!s)return;const a=JSON.parse(s),n=Array.isArray(a.order)?a.order:[];if(n.length&&Ie(i=>{const o=[...n,...i.filter(t=>!n.includes(t))];return Array.from(new Set(o))}),Array.isArray(a.visible)&&a.visible.length){const i=P.filter(o=>o.required).map(o=>o.id);De(Array.from(new Set([...a.visible,...i])))}}catch{}},[J]),r.useMemo(()=>["28px",...Os.map(a=>a.width)].join(" "),[Os]);const za=r.useMemo(()=>{const s=new Map;return ze.forEach(a=>s.set(a.id,a)),s},[ze]),Me=r.useMemo(()=>{const s=new Map;return k.forEach(a=>{if(a.assignedTo?.id){const n=s.get(a.assignedTo.id)??[];n.push(a),s.set(a.assignedTo.id,n)}}),s},[k]);r.useEffect(()=>{if(!V)return;const s=Me.get(V)??[];s.length===1&&j(a=>({...a,relatedAssetId:s[0].id}))},[V,Me]);const Rs=r.useMemo(()=>k.map(s=>({id:s.id,label:`${s.tag} â€¢ ${s.name}`,assignedToId:s.assignedTo?.id,assignedToName:s.assignedTo?.name})),[k]),zs=r.useMemo(()=>{const s=new Map;return k.forEach(a=>{a.assignedTo?.id&&s.set(a.assignedTo.id,{id:a.assignedTo.id,name:a.assignedTo.name})}),Array.from(s.values())},[k]),I=m&&typeof m.profile=="object"&&m.profile?m.profile.permissions:void 0,U=!!I?.tickets?.view&&!!I?.tickets?.create&&!I?.tickets?.edit&&!I?.tickets?.delete,Es=s=>{if(s.status!=="Aguardando aprovaÃ§Ã£o"||!m||U)return!1;if(s.approvalApproverId)return s.approvalApproverId===m.id;if(s.approvalApproverRole){const a=!!I?.settings?.manage,n=!a&&!!I?.tickets?.edit,i=a?"Admin":n?"Agent":void 0;return s.approvalApproverRole===i}return!!I?.settings?.manage||!!I?.tickets?.edit},Ea=r.useMemo(()=>Array.from(new Set(p.map(s=>s.system))),[p]),Pa=r.useMemo(()=>Array.from(new Set(p.map(s=>s.status))),[p]),Fa=ja,ee=r.useMemo(()=>{const s=He;return p.map(a=>{const n=a.slaDueAt??(a.priority?new Date(a.openedAt.getTime()+(a.priority==="P0"?je.urgentHours:a.priority==="P1"?je.highHours:a.priority==="P2"?je.mediumHours:je.lowHours)*60*60*1e3):null),i=n?n.getTime()<s:!1,o=n!=null?n.getTime()>=s&&n.getTime()<=s+2880*60*1e3:!1,t=n!=null?n.getTime()>=s&&n.getTime()<=s+Fa*60*1e3:!1,h=(a.comments??[]).map(g=>({...g,at:g.at instanceof Date?g.at:new Date(g.at)}));return{...a,slaDueAt:n,isSlaOverdue:i,isSlaRisk:o,isSlaWarning:t,comments:h}})},[p,He]),Ps=r.useMemo(()=>(_?Za(ee,_):ee).filter(n=>B==="triage"?n.status==="Triagem":B==="approvals"?n.status==="Aguardando aprovaÃ§Ã£o"&&Es(n):B==="overdue"?n.isSlaOverdue:B==="risk"?n.isSlaRisk:B==="waitingVendor"?n.status==="Aguardando fornecedor":B==="unlinked"?!n.demandId:n.status!=="Fechado"&&n.status!=="Cancelado").filter(n=>{const i=ce==="all"||n.system===ce,o=ue==="all"||n.status===ue,t=D==="all"||n.queue===D,h=!xe.trim()||`${n.code} ${n.subject} ${n.system} ${n.category}`.toLowerCase().includes(xe.toLowerCase());return i&&o&&t&&h}),[_,ee,ce,ue,B,D,xe,me,m?.name,m?.email]),se=r.useMemo(()=>{const s=a=>a==="P0"?0:a==="P1"?1:a==="P2"?2:3;return[...Ps].sort((a,n)=>a.isSlaOverdue!==n.isSlaOverdue?a.isSlaOverdue?-1:1:a.slaDueAt&&n.slaDueAt&&a.slaDueAt.getTime()!==n.slaDueAt.getTime()?a.slaDueAt.getTime()-n.slaDueAt.getTime():a.priority!==n.priority?s(a.priority)-s(n.priority):a.openedAt.getTime()-n.openedAt.getTime())},[Ps]),R=r.useMemo(()=>{const s=ee.filter(o=>o.status!=="Fechado"&&o.status!=="Cancelado"),a=s.filter(o=>o.isSlaOverdue).length,n=s.filter(o=>o.isSlaRisk).length,i=s.filter(o=>o.isSlaWarning).length;return{total:s.length,overdue:a,risk:n,warning:i}},[ee]),Ba=r.useMemo(()=>`${ss}% 1fr`,[ss]);function $a(s){s.preventDefault();const a=s.clientX,n=ss;function i(t){if(!as.current)return;const h=as.current.getBoundingClientRect(),g=t.clientX-a,T=(n/100*h.width+g)/h.width,x=Math.min(80,Math.max(40,T*100));Ra(x)}function o(){window.removeEventListener("mousemove",i),window.removeEventListener("mouseup",o)}window.addEventListener("mousemove",i),window.addEventListener("mouseup",o)}function La(s){if(!s.slaDueAt)return"Sem SLA";const a=He,n=s.slaDueAt.getTime()-a,i=Math.floor(Math.abs(n)/(1e3*60)),o=Math.floor(i/60),t=Math.floor(o/24),h=o%24,g=i%60,T=`${t}d ${h}h ${g}m`;return n<0?`Atrasado ${T}`:`Faltam ${T}`}function ns(s){const a=ks(),n=a.views.find(x=>x.id===C&&x.scope==="tickets"),i=Array.from(new Set(s.filter(x=>P.some(ne=>ne.id===x)))),o=P.filter(x=>x.required).map(x=>x.id),t=Array.from(new Set([...i,...o]));if(n){if(n.isDefault){const x=`t_custom_${Date.now()}`,ne={...n,id:x,name:`${n.name} (custom)`,isDefault:!1,isPinned:!0,columns:t,updatedAt:new Date().toISOString()};is(ne),Xs("tickets",x),$(x);return}is({...n,columns:t,updatedAt:new Date().toISOString()});try{localStorage.setItem(J,JSON.stringify({order:W,visible:t}))}catch{}return}const h=a.views.find(x=>x.scope==="tickets")??{id:`t_custom_${Date.now()}`,scope:"tickets",name:"Minha view",description:"View customizada",filters:[],sort:[],columns:t,isPinned:!0,isDefault:!1,updatedAt:new Date().toISOString()},g=h.id.startsWith("t_")?h.id:`t_custom_${Date.now()}`,T={...h,id:g,columns:t,isPinned:!0,isDefault:!1,updatedAt:new Date().toISOString()};is(T),Xs("tickets",T.id),$(T.id);try{localStorage.setItem(J,JSON.stringify({order:W,visible:t}))}catch{}}function qa(s){P.find(n=>n.id===s)?.required||De(n=>{const o=n.includes(s)?n.filter(h=>h!==s):[...n,s],t=W.filter(h=>o.includes(h));return ns(t),o})}function Va(s,a){s!==a&&Ie(n=>{const i=n.filter(h=>h!==s),o=i.indexOf(a);i.splice(o<0?i.length:o,0,s);const t=i.filter(h=>Te.includes(h));ns(t);try{localStorage.setItem(J,JSON.stringify({order:i,visible:t}))}catch{}return i})}function ka(){const s=["slaDueAt","subject","queue","status","priority","openedAt"],a=P.filter(o=>o.required).map(o=>o.id),n=Array.from(new Set([...s,...a])),i=Array.from(new Set([...s,...ds]));De(n),Ie(i),ns(n);try{localStorage.setItem(J,JSON.stringify({order:i,visible:n}))}catch{}}const Fs=M.size;function Ha(s){Be(a=>{const n=new Set(a);return n.has(s)?n.delete(s):n.add(s),n})}function ae(){Be(new Set)}const Bs=se.length>0&&se.every(s=>M.has(s.id));async function Wa(){if(!M.size)return;const s=Array.from(M);await Promise.all(s.map(a=>S(a,{status:Cs}))),we(!1),ae()}async function _a(){if(!M.size||!Se)return;const s=Array.from(M);await Promise.all(s.map(a=>S(a,{queue:"Fornecedor",status:"Aguardando fornecedor",externalOwnerId:Se}))),Ce(!1),Ss(""),ae()}async function Ja(){if(!M.size)return;const s=m?.name||m?.email;if(!s)return;const a=Array.from(M);await Promise.all(a.map(n=>S(n,{assignee:s}))),ae()}const $s=s=>e.jsxs("div",{className:"grid gap-4 lg:grid-cols-[1.6fr_0.9fr]",children:[e.jsxs("div",{children:[e.jsxs(Xa,{defaultValue:"timeline",children:[e.jsxs(Ga,{className:"flex flex-wrap",children:[e.jsx(te,{value:"timeline",children:"Conversas"}),e.jsx(te,{value:"resumo",children:"Resumo"}),e.jsx(te,{value:"sla",children:"SLA"}),e.jsx(te,{value:"evidencias",children:"EvidÃªncias"}),e.jsx(te,{value:"vinculo",children:"VÃ­nculo"})]}),e.jsx(le,{value:"resumo",children:e.jsxs("div",{className:"grid gap-2 text-sm text-muted-foreground",children:[e.jsx("p",{children:s.subject}),e.jsxs("p",{className:"flex items-center gap-2",children:["Status: ",e.jsx(F,{variant:os[s.status],children:s.status})]}),e.jsxs("p",{children:["Fila: ",s.queue]}),e.jsxs("p",{children:["Prioridade: ",s.priority]}),e.jsxs("p",{children:["Canal: ",s.channel??"Manual"]}),e.jsxs("p",{children:["Sistema: ",s.system]}),e.jsxs("p",{children:["Categoria: ",s.category]}),e.jsxs("p",{children:["Impacto/UrgÃªncia: ",s.impact," / ",s.urgency]}),e.jsxs("p",{className:"flex items-center gap-2",children:["ResponsÃ¡vel:",e.jsx("span",{className:"flex h-6 w-6 items-center justify-center rounded-full bg-muted text-[10px] font-semibold text-foreground",children:Re(s.assignee)}),s.assignee??"-"]})]})}),e.jsx(le,{value:"timeline",children:e.jsxs("div",{className:"grid gap-4 text-sm text-muted-foreground",children:[xa?e.jsx("p",{className:"text-xs",children:"Carregando emails..."}):null,(()=>{const a=ma[s.id]??[],n=(s.comments??[]).map((t,h)=>{const g=String(t.message??"").toLowerCase().startsWith("status alterado");return{id:`comment-${h}`,type:g?"system":"note",at:t.at,author:t.author,message:t.message}}),i=a.map(t=>({id:`email-${t.id}`,type:t.type,at:t.at,subject:t.subject,from:t.from,to:t.to,snippet:t.snippet,status:t.status,error:t.error,textBody:t.textBody,htmlBody:t.htmlBody,attachments:t.attachments})),o=[...n,...i].sort((t,h)=>new Date(t.at).getTime()-new Date(h.at).getTime());return o.length?o.map(t=>{if(t.type==="system")return e.jsx("div",{className:"flex justify-center",children:e.jsx("div",{className:"rounded-full bg-muted px-3 py-1 text-xs text-muted-foreground",children:t.message})},t.id);const h=t.type==="inbound",g=h?"bg-white/90 text-slate-800 border border-slate-200":t.type==="note"?"bg-amber-100/80 text-amber-900 border border-amber-200":"bg-slate-100 text-slate-700 border border-slate-200",T=h?"justify-start":"justify-end";return e.jsx("div",{className:`flex ${T}`,children:e.jsxs("div",{className:`max-w-[82%] rounded-xl p-3 ${g}`,children:[e.jsxs("div",{className:"mb-2 flex items-center justify-between gap-3 text-xs text-muted-foreground",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"flex h-6 w-6 items-center justify-center rounded-full bg-muted text-[10px] font-semibold text-foreground",children:Re(h?t.from:t.author??m?.name)}),e.jsx("span",{className:"font-medium text-foreground",children:h?t.from??"Cliente":t.author??m?.name??"Agente"})]}),e.jsx("span",{children:dn(new Date(t.at))})]}),t.type==="note"?e.jsx("p",{className:"text-sm",children:t.message}):e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-sm font-medium",children:t.subject}),e.jsx("p",{className:"text-xs text-muted-foreground",children:h?`De: ${t.from}`:`Para: ${t.to}`}),t.snippet?e.jsx("p",{className:"text-xs",children:t.snippet}):null]}),t.attachments?.length?e.jsx("div",{className:"mt-2 flex flex-wrap gap-2 text-xs",children:t.attachments.map(x=>e.jsxs(l,{size:"sm",variant:"outline",onClick:async()=>{if(!d)return;const ne=`http://localhost:3000/api/tickets/${s.id}/emails/${t.id}/attachment/${x.index}`,rs=await fetch(ne,{headers:{Authorization:`Bearer ${d}`}});if(!rs.ok)return;const Ls=await rs.blob(),Oe=rs.headers.get("content-type")||x.contentType,re=document.createElement("a");if(re.href=window.URL.createObjectURL(Ls),re.download=x.filename||"anexo",document.body.appendChild(re),re.click(),re.remove(),Oe?.startsWith("image/")||Oe==="application/pdf"){const qs=window.URL.createObjectURL(Ls);fs({emailId:t.id,index:x.index,url:qs,contentType:Oe,filename:x.filename}),Oe.startsWith("image/")&&pa(ts=>ts.some(Vs=>Vs.emailId===t.id&&Vs.index===x.index)?ts:[...ts,{emailId:t.id,index:x.index,url:qs,filename:x.filename}])}},children:[x.filename??"Anexo"," ",x.size?`(${Math.round(x.size/1024)} KB)`:""]},`${t.id}-${x.index}`))}):null,t.textBody||t.htmlBody?e.jsxs("div",{className:"mt-2",children:[e.jsx(l,{size:"sm",variant:"ghost",onClick:()=>ha(x=>x===t.id?null:t.id),children:gs===t.id?"Ocultar conteÃºdo":"Ver conteÃºdo"}),gs===t.id?e.jsxs("div",{className:"mt-2 grid gap-2",children:[t.htmlBody?e.jsxs("div",{className:"rounded-md border border-border/60 bg-background/40 p-2 text-xs",children:[e.jsx("div",{className:"mb-2 text-xs text-muted-foreground",children:"Preview HTML"}),e.jsx("iframe",{title:`email-html-${t.id}`,className:"h-60 w-full rounded-md border border-border/60 bg-white",sandbox:"allow-same-origin",srcDoc:t.htmlBody})]}):null,t.textBody?e.jsx("pre",{className:"max-h-60 whitespace-pre-wrap rounded-md border border-border/60 bg-background/40 p-2 text-xs",children:t.textBody}):null]}):null]}):null,t.status==="failed"?e.jsx("p",{className:"text-xs text-destructive",children:t.error??"Falha ao enviar"}):null]})},t.id)}):e.jsx("p",{children:"Sem atividades registradas."})})(),v?e.jsxs("div",{className:"rounded-md border border-border/60 bg-background/40 p-2",children:[e.jsxs("div",{className:"mb-2 flex items-center justify-between text-xs text-muted-foreground",children:[e.jsxs("span",{children:["Preview: ",v.filename??"Anexo"]}),e.jsx(l,{size:"sm",variant:"ghost",onClick:()=>{URL.revokeObjectURL(v.url),fs(null)},children:"Fechar"})]}),v.contentType?.startsWith("image/")?e.jsx("img",{src:v.url,alt:v.filename??"anexo",className:"max-h-64 w-auto rounded-md border border-border/60"}):v.contentType==="application/pdf"?e.jsx("iframe",{src:v.url,className:"h-64 w-full rounded-md border border-border/60",title:v.filename??"pdf"}):null]}):null]})}),e.jsx(le,{value:"sla",children:e.jsxs("div",{className:"grid gap-2 text-sm text-muted-foreground",children:[e.jsxs("p",{children:["Aberto em: ",s.openedAt.toLocaleDateString("pt-BR")]}),e.jsxs("p",{children:["SLA vence em:"," ",s.slaDueAt?s.slaDueAt.toLocaleDateString("pt-BR"):"-"]}),e.jsxs("p",{children:["Overdue: ",s.isSlaOverdue?"Sim":"NÃ£o"]})]})}),e.jsx(le,{value:"evidencias",children:e.jsx("p",{className:"text-sm text-muted-foreground",children:"Sem evidÃªncias."})}),e.jsx(le,{value:"vinculo",children:e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Demanda vinculada: ",s.demandId??"-"]})})]}),e.jsxs("div",{className:"mt-4 rounded-xl border border-border/60 bg-background/50 p-4",children:[e.jsxs("div",{className:"mb-3 flex items-center justify-between",children:[e.jsx("p",{className:"text-sm font-semibold text-foreground",children:"Responder"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(l,{size:"sm",variant:We==="reply"?"default":"outline",onClick:()=>bs("reply"),children:"Responder ao Cliente"}),e.jsx(l,{size:"sm",variant:We==="note"?"secondary":"outline",onClick:()=>bs("note"),children:"Nota Interna"})]})]}),We==="reply"?e.jsxs("div",{className:"grid gap-3 text-sm text-muted-foreground",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("label",{className:"text-xs text-muted-foreground",children:"Para"}),e.jsx(l,{size:"sm",variant:"ghost",className:"h-6 px-2 text-[11px]",onClick:()=>ua(a=>!a),children:"Adicionar Cc / Cco"})]}),e.jsx(z,{value:Q,onChange:a=>xs(a.target.value),placeholder:"destinatario@empresa.com"}),ca?e.jsxs("div",{className:"grid gap-2 lg:grid-cols-2",children:[e.jsxs("div",{className:"grid gap-1",children:[e.jsx("label",{className:"text-[11px] text-muted-foreground",children:"Cc"}),e.jsx(z,{value:qe,onChange:a=>da(a.target.value),placeholder:"copia@empresa.com"})]}),e.jsxs("div",{className:"grid gap-1",children:[e.jsx("label",{className:"text-[11px] text-muted-foreground",children:"Cco"}),e.jsx(z,{value:Ve,onChange:a=>oa(a.target.value),placeholder:"oculto@empresa.com"})]})]}):null]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx("label",{className:"text-xs text-muted-foreground",children:"Assunto"}),e.jsx(z,{value:K,onChange:a=>hs(a.target.value),placeholder:"Re: assunto do chamado"})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("label",{className:"text-xs text-muted-foreground",children:"Resposta pronta"}),e.jsxs(l,{size:"sm",variant:"ghost",className:"h-6 px-2 text-[11px]",onClick:()=>be(!0),children:[e.jsx(sn,{className:"mr-1 h-3.5 w-3.5"}),"Inserir"]})]}),e.jsx("select",{className:"h-10 rounded-md border border-input bg-transparent px-3 text-sm",value:G,onChange:a=>{const n=a.target.value;ve(n);const i=f.find(o=>o.id===n);i&&O(de(i.body,s))},children:f.map(a=>e.jsx("option",{value:a.id,children:a.title},a.id))})]}),e.jsx(ie,{value:q,onChange:a=>O(a.target.value),placeholder:"Digite a resposta para o solicitante...",onKeyDown:a=>{a.key==="/"&&be(!0)}}),ge.length?e.jsx("div",{className:"grid gap-2 rounded-md border border-border/60 bg-background/40 p-2 text-xs text-muted-foreground",children:ge.map((a,n)=>e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(rn,{className:"h-3.5 w-3.5"}),e.jsx("span",{className:"max-w-[180px] truncate",children:a.name}),e.jsxs("span",{className:"text-[10px] text-muted-foreground",children:[(a.size/1024).toFixed(1)," KB"]})]}),e.jsx(l,{size:"icon",variant:"ghost",className:"h-6 w-6",onClick:()=>fe(i=>i.filter((o,t)=>t!==n)),children:e.jsx(Ka,{className:"h-3 w-3"})})]},`${a.name}-${n}`))}):null,e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("label",{className:"flex items-center gap-2 rounded-md border border-input px-3 py-1 text-xs text-muted-foreground hover:bg-muted",children:["Anexar arquivos",e.jsx("input",{type:"file",multiple:!0,className:"hidden",onChange:a=>{const n=Array.from(a.target.files??[]);fe(n)}})]}),e.jsx(l,{size:"sm",variant:"outline",onClick:()=>O(""),children:"Limpar"})]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx(l,{size:"sm",onClick:async()=>{if(!q.trim()||!d||!Q.trim()||!K.trim())return;const a=c?de(q.trim(),c):q.trim();await Ks(d,s.id,{to:Q.trim(),cc:qe.trim()||void 0,bcc:Ve.trim()||void 0,subject:K.trim(),body:a,statusAfter:"Aguardando solicitante",files:ge}),O(""),fe([]);try{const n=await ls(d,s.id);ke(i=>({...i,[s.id]:n.items}))}catch{}},children:"Enviar e Manter Pendente"}),e.jsx(l,{size:"sm",variant:"outline",onClick:async()=>{if(!q.trim()||!d||!Q.trim()||!K.trim())return;const a=c?de(q.trim(),c):q.trim();await Ks(d,s.id,{to:Q.trim(),cc:qe.trim()||void 0,bcc:Ve.trim()||void 0,subject:K.trim(),body:a,statusAfter:"Resolvido",files:ge}),O(""),fe([]);try{const n=await ls(d,s.id);ke(i=>({...i,[s.id]:n.items}))}catch{}},children:"Enviar e Resolver"})]})]})]}):e.jsxs("div",{className:"grid gap-3 text-sm text-muted-foreground",children:[e.jsx(ie,{className:"border-amber-300 bg-amber-50/70 text-amber-900",value:_e,onChange:a=>Je(a.target.value),placeholder:"Escreva uma nota interna para a equipe..."}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(l,{size:"sm",variant:"outline",onClick:()=>Je(""),children:"Limpar"}),e.jsx(l,{size:"sm",className:"bg-amber-500 text-amber-950 hover:bg-amber-400",onClick:async()=>{_e.trim()&&(await cs(s.id,_e.trim()),Je(""))},children:"Salvar nota interna"})]})]})]})]}),e.jsx("aside",{className:"space-y-3",children:e.jsxs("div",{className:"rounded-xl border border-border/60 bg-background/40 p-4 text-sm text-muted-foreground",children:[e.jsx("p",{className:"mb-2 text-xs font-semibold uppercase tracking-wide text-muted-foreground",children:"InformaÃ§Ãµes do Chamado"}),e.jsxs("div",{className:"grid gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-muted-foreground",children:"Status"}),e.jsx("select",{className:"mt-1 h-9 w-full rounded-md border border-input bg-transparent px-2 text-xs",value:s.status,onChange:async a=>S(s.id,{status:a.target.value}),children:["Novo","Triagem","Em atendimento","Aguardando fornecedor","Aguardando solicitante","Resolvido","Fechado","Cancelado"].map(a=>e.jsx("option",{value:a,children:a},a))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-muted-foreground",children:"Prioridade"}),e.jsx("select",{className:"mt-1 h-9 w-full rounded-md border border-input bg-transparent px-2 text-xs",value:s.priority,onChange:async a=>S(s.id,{priority:a.target.value}),children:["P0","P1","P2","P3"].map(a=>e.jsx("option",{value:a,children:a},a))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-xs text-muted-foreground",children:"Ativo relacionado"}),e.jsxs("select",{className:"mt-1 h-9 w-full rounded-md border border-input bg-transparent px-2 text-xs",value:s.relatedAssetId??"",onChange:async a=>S(s.id,{relatedAssetId:a.target.value||void 0}),children:[e.jsx("option",{value:"",children:"Sem ativo"}),Rs.map(a=>e.jsx("option",{value:a.id,children:a.label},a.id))]})]}),e.jsxs("div",{className:"grid gap-1 text-xs",children:[e.jsxs("span",{children:["SLA: ",s.slaDueAt?s.slaDueAt.toLocaleDateString("pt-BR"):"Sem SLA"]}),e.jsxs("span",{children:["Fila: ",s.queue]}),e.jsxs("span",{children:["Canal: ",s.channel??"Manual"]}),e.jsxs("span",{children:["Sistema: ",s.system]}),e.jsxs("span",{children:["Categoria: ",s.category]}),e.jsxs("span",{children:["Impacto: ",s.impact]}),e.jsxs("span",{children:["UrgÃªncia: ",s.urgency]})]})]})]})})]});return e.jsxs(Hs,{className:"bg-card/70",children:[e.jsxs(Ws,{children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2",children:[e.jsxs("div",{children:[e.jsx(_s,{children:"Chamados"}),e.jsx(Js,{children:"Inbox estilo Desk com foco em SLA e priorizaÃ§Ã£o."})]}),U?null:e.jsx(l,{size:"sm",onClick:()=>Ae(!0),children:"Novo chamado"})]}),e.jsxs("div",{className:"mt-3 flex flex-wrap items-center gap-2",children:[e.jsx(l,{size:"sm",variant:me==="mine"?"default":"outline",onClick:()=>Fe("mine"),children:"Meus chamados"}),e.jsx(l,{size:"sm",variant:me==="today"?"default":"outline",onClick:()=>Fe("today"),children:"Vencendo hoje"}),e.jsx(l,{size:"sm",variant:me==="all"?"default":"outline",onClick:()=>Fe("all"),children:"Todos"})]}),e.jsxs("div",{className:"mt-3 flex flex-wrap items-center gap-2",children:[e.jsx(l,{size:"sm",variant:D==="all"?"default":"outline",onClick:()=>Pe("all"),children:"Todas as filas"}),e.jsx(l,{size:"sm",variant:D==="TI Interna"?"default":"outline",onClick:()=>Pe("TI Interna"),children:"TI Interna"}),e.jsx(l,{size:"sm",variant:D==="Fornecedor"?"default":"outline",onClick:()=>Pe("Fornecedor"),children:"Fornecedor"})]}),e.jsxs("div",{className:"mt-3 grid gap-3 lg:grid-cols-3",children:[e.jsx(z,{value:xe,onChange:s=>ta(s.target.value),placeholder:"ðŸ” Buscar por cÃ³digo, assunto ou sistema..."}),e.jsxs("select",{className:"h-10 rounded-md border border-input bg-transparent px-3 text-sm",value:ce,onChange:s=>aa(s.target.value),children:[e.jsx("option",{value:"all",children:"Todos os sistemas"}),Ea.map(s=>e.jsx("option",{value:s,children:s},s))]}),e.jsxs("select",{className:"h-10 rounded-md border border-input bg-transparent px-3 text-sm",value:ue,onChange:s=>na(s.target.value),children:[e.jsx("option",{value:"all",children:"Todas as situaÃ§Ãµes"}),Pa.map(s=>e.jsx("option",{value:s,children:s},s))]})]}),e.jsx("div",{className:"mt-3",children:e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx(Ya,{scope:"tickets",activeViewId:C,onChangeActive:$}),e.jsx(l,{size:"sm",variant:"outline",onClick:()=>es(!0),children:"Colunas"})]})}),e.jsx("div",{className:"mt-3 flex flex-wrap gap-2",children:ln.map(s=>e.jsx(l,{size:"sm",variant:B===s.id?"default":"outline",onClick:()=>ra(s.id),children:s.label},s.id))}),R.overdue>0||R.warning>0?e.jsxs("div",{className:"mt-4 rounded-lg border border-amber-500/40 bg-amber-500/10 p-3 text-sm text-amber-100",children:[R.overdue>0?e.jsxs("p",{className:"font-semibold",children:[R.overdue," chamado(s) com SLA estourado."]}):null,R.warning>0?e.jsxs("p",{className:"text-xs text-amber-100/80",children:[R.warning," chamado(s) vencem em breve."]}):null]}):null,e.jsxs("div",{className:"mt-4 grid gap-3 text-sm lg:grid-cols-3",children:[e.jsxs("div",{className:"rounded-lg border border-border/60 bg-background/40 p-3",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Chamados abertos"}),e.jsx("p",{className:"text-lg font-semibold text-foreground",children:R.total})]}),e.jsxs("div",{className:"rounded-lg border border-amber-500/40 bg-amber-500/10 p-3",children:[e.jsx("p",{className:"text-xs text-amber-200",children:"SLA estourado"}),e.jsx("p",{className:"text-lg font-semibold text-amber-100",children:R.overdue})]}),e.jsxs("div",{className:"rounded-lg border border-orange-500/40 bg-orange-500/10 p-3",children:[e.jsx("p",{className:"text-xs text-orange-200",children:"Vence em breve"}),e.jsx("p",{className:"text-lg font-semibold text-orange-100",children:R.warning})]})]})]}),e.jsxs(Qs,{className:"grid gap-4 lg:grid-cols-[1.6fr_1fr] lg:items-start",children:[e.jsxs("div",{ref:as,className:"grid gap-4 lg:items-start",style:{gridTemplateColumns:Ba},children:[e.jsxs("div",{className:"space-y-3 text-sm text-muted-foreground",children:[!U&&Fs>0?e.jsxs("div",{className:"flex flex-wrap items-center gap-2 rounded-lg border border-border/60 bg-background/40 p-3",children:[e.jsxs("span",{className:"text-xs text-muted-foreground",children:[Fs," selecionado(s)"]}),e.jsx(l,{size:"sm",variant:"outline",onClick:Ja,children:"Atribuir a mim"}),e.jsx(l,{size:"sm",variant:"outline",onClick:()=>we(!0),children:"Mudar status"}),e.jsx(l,{size:"sm",variant:"outline",onClick:()=>Ce(!0),children:"Mover para fornecedor"}),e.jsx("div",{className:"flex-1"}),e.jsx(l,{size:"sm",variant:"ghost",onClick:ae,children:"Limpar seleÃ§Ã£o"})]}):null,se.length===0?e.jsx("p",{children:"Nenhum chamado encontrado."}):null,U?null:e.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground",children:[e.jsx("input",{type:"checkbox",checked:Bs,onChange:()=>{Bs?ae():Be(new Set(se.map(s=>s.id)))}}),e.jsx("span",{children:"Selecionar todos os chamados visÃ­veis"})]}),se.map(s=>e.jsxs("div",{className:`group relative rounded-lg border p-4 transition ${c?.id===s.id?"border-primary/50 bg-primary/5":"border-border/60 bg-background/40 hover:border-border"}`,onClick:()=>{L(s),Ze(s),Ge(!0)},children:[e.jsxs("div",{className:"flex items-start gap-3",children:[U?null:e.jsx("div",{className:"pt-1",children:e.jsx("input",{type:"checkbox",checked:M.has(s.id),onChange:()=>Ha(s.id),onClick:a=>a.stopPropagation()})}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsxs("div",{className:"flex items-start justify-between gap-3",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex flex-wrap items-center gap-2",children:[e.jsx("span",{className:"text-xs uppercase tracking-wide text-muted-foreground",children:s.code}),e.jsx(F,{variant:os[s.status],className:"px-2 py-0 text-[10px]",children:s.status})]}),e.jsx("p",{className:"text-sm font-semibold text-foreground",children:s.subject})]}),e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:`flex h-9 w-9 items-center justify-center rounded-full text-[10px] font-semibold ${s.assignee?"bg-muted text-foreground":"border border-dashed border-amber-400/60 bg-amber-500/10 text-amber-200"}`,title:s.assignee??"NÃ£o atribuÃ­do",children:Re(s.assignee)}),s.assignee?null:e.jsx("span",{className:"absolute -right-1 -top-1 h-2.5 w-2.5 rounded-full bg-amber-400"})]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3 text-xs text-muted-foreground",children:[e.jsxs("span",{className:"inline-flex items-center gap-1",children:[e.jsx(Ua,{className:"h-3.5 w-3.5"}),s.slaDueAt?s.slaDueAt.toLocaleDateString("pt-BR"):"Sem SLA"]}),e.jsxs("span",{className:"inline-flex items-center gap-1",children:[e.jsx(an,{className:"h-3.5 w-3.5"}),s.priority]}),e.jsxs("span",{className:"inline-flex items-center gap-1",children:[e.jsx(nn,{className:"h-3.5 w-3.5"}),s.channel??"Manual"]}),e.jsxs("span",{className:"inline-flex items-center gap-1",children:[e.jsx(tn,{className:"h-3.5 w-3.5"}),s.assignee??"NÃ£o atribuÃ­do"]}),s.isSlaOverdue?e.jsxs("span",{className:"inline-flex items-center gap-1 text-amber-200",children:[e.jsx(en,{className:"h-3.5 w-3.5"}),"Estourado"]}):null]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 text-xs text-muted-foreground",children:[e.jsx(F,{variant:"outline",className:"px-2 py-0 text-[10px]",children:s.queue}),e.jsxs("span",{children:["Sistema: ",s.system||"-"]}),e.jsxs("span",{children:["Categoria: ",s.category||"-"]}),e.jsxs("span",{children:["Demanda: ",s.demandId?za.get(s.demandId)?.name??"â€”":"Sem vÃ­nculo"]}),e.jsx("span",{className:"text-[10px] text-muted-foreground",children:La(s)})]})]})]}),e.jsx("div",{className:"pointer-events-none absolute inset-x-2 bottom-2 flex justify-end opacity-0 transition group-hover:pointer-events-auto group-hover:opacity-100",children:e.jsxs("div",{className:"flex gap-2 rounded-md border border-border/60 bg-background/90 p-1 shadow",children:[e.jsx(l,{size:"sm",variant:"ghost",onClick:a=>{a.stopPropagation(),L(s),Ze(s),Ge(!0)},children:"Detalhes"}),e.jsx(l,{size:"sm",variant:"ghost",onClick:a=>{a.stopPropagation();const n=m?.name||m?.email;n&&S(s.id,{assignee:n})},children:"Assumir"}),e.jsx(l,{size:"sm",variant:"ghost",onClick:a=>{a.stopPropagation(),L(s),Ke(s.status),Z(!0)},children:"Mudar status"})]})})]},s.id))]}),e.jsxs("div",{className:"hidden items-stretch lg:flex",children:[e.jsx("div",{className:"mx-2 w-1 cursor-col-resize rounded-full bg-border/60 hover:bg-border",onMouseDown:$a}),e.jsx("div",{className:"sticky top-6 w-full",children:e.jsxs(Hs,{className:"bg-card/70",children:[e.jsxs(Ws,{children:[e.jsx(_s,{children:"Detalhe do chamado"}),e.jsx(Js,{children:c?`${c.code} â€¢ ${c.subject}`:"Selecione um chamado para ver o detalhe."})]}),e.jsx(Qs,{className:"space-y-4 text-sm text-muted-foreground",children:c?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-wrap gap-2",children:[Es(c)?e.jsxs(e.Fragment,{children:[e.jsx(l,{size:"sm",onClick:async()=>{await ea(c.id)},children:"Aprovar"}),e.jsx(l,{size:"sm",variant:"outline",onClick:()=>{Le(""),pe(!0)},children:"Rejeitar"})]}):null,e.jsx(l,{size:"sm",variant:"outline",onClick:()=>{const s=m?.name||m?.email;s&&S(c.id,{assignee:s})},children:"Assumir"}),e.jsx(l,{size:"sm",variant:Ye?"default":"outline",onClick:()=>Ue(s=>!s),children:Ye?"Editar ativo":"Editar"}),e.jsx(l,{size:"sm",variant:"outline",onClick:()=>{L(c),Ke(c.status),Z(!0)},children:"Mudar status"}),e.jsx(l,{size:"sm",variant:"outline",onClick:()=>{L(c),he(!0)},children:"ComentÃ¡rio"}),e.jsx(l,{size:"sm",variant:"outline",onClick:()=>{L(c),ye(!0)},children:"Vincular demanda"}),e.jsx(l,{size:"sm",variant:"outline",onClick:()=>{L(c),ws(""),Ne(!0)},children:"Mover para fornecedor"}),I?.tickets?.delete||I?.settings?.manage?e.jsx(l,{size:"sm",variant:"outline",onClick:async()=>{window.confirm("Tem certeza que deseja excluir este chamado? Esta aÃ§Ã£o Ã© irreversÃ­vel.")&&await Us(c.id)},children:"Excluir"}):null]}),Ye?e.jsxs("div",{className:"grid gap-3 rounded-lg border border-border/60 bg-background/40 p-3",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx("label",{className:"text-xs text-muted-foreground",children:"Status"}),e.jsx("select",{className:"h-10 rounded-md border border-input bg-transparent px-3 text-sm",value:As,onChange:s=>Is(s.target.value),children:["Novo","Triagem","Em atendimento","Aguardando fornecedor","Aguardando solicitante","Aguardando aprovaÃ§Ã£o","Resolvido","Fechado","Cancelado"].map(s=>e.jsx("option",{value:s,children:s},s))})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx("label",{className:"text-xs text-muted-foreground",children:"Prioridade"}),e.jsx("select",{className:"h-10 rounded-md border border-input bg-transparent px-3 text-sm",value:Ts,onChange:s=>Ds(s.target.value),children:["P0","P1","P2","P3"].map(s=>e.jsx("option",{value:s,children:s},s))})]}),e.jsxs("div",{className:"flex justify-end gap-2",children:[e.jsx(l,{size:"sm",variant:"secondary",onClick:()=>Ue(!1),children:"Cancelar"}),e.jsx(l,{size:"sm",onClick:async()=>{await S(c.id,{status:As,priority:Ts}),Ue(!1)},children:"Salvar"})]})]}):null,$s(c)]}):null})]})})]})]}),e.jsx(b,{open:la,onOpenChange:he,children:e.jsxs(y,{children:[e.jsx(N,{children:e.jsx(w,{children:"Adicionar comentÃ¡rio"})}),e.jsx(ie,{value:us,onChange:s=>ms(s.target.value),placeholder:"Descreva o comentÃ¡rio"}),e.jsxs(E,{children:[e.jsx(l,{variant:"secondary",onClick:()=>he(!1),children:"Cancelar"}),e.jsx(l,{onClick:async()=>{A&&(await cs(A.id,us),ms(""),he(!1))},children:"Salvar"})]})]})}),e.jsx(b,{open:ia,onOpenChange:pe,children:e.jsxs(y,{children:[e.jsx(N,{children:e.jsx(w,{children:"Rejeitar aprovaÃ§Ã£o"})}),e.jsx(ie,{value:$e,onChange:s=>Le(s.target.value),placeholder:"Informe o motivo da rejeiÃ§Ã£o"}),e.jsxs(E,{children:[e.jsx(l,{variant:"secondary",onClick:()=>pe(!1),children:"Cancelar"}),e.jsx(l,{disabled:!$e.trim()||!c,onClick:async()=>{c&&(await sa(c.id,$e.trim()),pe(!1),Le(""))},children:"Rejeitar"})]})]})}),e.jsx(b,{open:wa,onOpenChange:ye,children:e.jsxs(y,{children:[e.jsx(N,{children:e.jsx(w,{children:"Vincular demanda"})}),e.jsxs("select",{className:"h-10 rounded-md border border-input bg-transparent px-3 text-sm",value:Qe,onChange:s=>ys(s.target.value),children:[e.jsx("option",{value:"",children:"Selecione uma demanda"}),ze.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]}),e.jsxs(E,{children:[e.jsx(l,{variant:"secondary",onClick:()=>ye(!1),children:"Cancelar"}),e.jsx(l,{onClick:async()=>{!A||!Qe||(await Ys(A.id,Qe),ys(""),ye(!1))},children:"Vincular"})]})]})}),e.jsx(b,{open:Ca,onOpenChange:Z,children:e.jsxs(y,{children:[e.jsx(N,{children:e.jsx(w,{children:"Alterar status"})}),e.jsx("select",{className:"h-10 rounded-md border border-input bg-transparent px-3 text-sm",value:Ns,onChange:s=>Ke(s.target.value),children:["Novo","Triagem","Em atendimento","Aguardando fornecedor","Aguardando solicitante","Aguardando aprovaÃ§Ã£o","Resolvido","Fechado","Cancelado"].map(s=>e.jsx("option",{value:s,children:s},s))}),e.jsxs(E,{children:[e.jsx(l,{variant:"secondary",onClick:()=>Z(!1),children:"Cancelar"}),e.jsx(l,{onClick:async()=>{A&&(await S(A.id,{status:Ns}),Z(!1))},children:"Salvar"})]})]})}),e.jsx(b,{open:Aa,onOpenChange:we,children:e.jsxs(y,{children:[e.jsx(N,{children:e.jsx(w,{children:"Mudar status em lote"})}),e.jsx("select",{className:"h-10 rounded-md border border-input bg-transparent px-3 text-sm",value:Cs,onChange:s=>Ia(s.target.value),children:["Novo","Triagem","Em atendimento","Aguardando fornecedor","Aguardando solicitante","Aguardando aprovaÃ§Ã£o","Resolvido","Fechado","Cancelado"].map(s=>e.jsx("option",{value:s,children:s},s))}),e.jsxs(E,{children:[e.jsx(l,{variant:"secondary",onClick:()=>we(!1),children:"Cancelar"}),e.jsx(l,{onClick:Wa,children:"Aplicar"})]})]})}),e.jsx(b,{open:Ta,onOpenChange:Ce,children:e.jsxs(y,{children:[e.jsx(N,{children:e.jsx(w,{children:"Mover para fornecedor (lote)"})}),e.jsxs("select",{className:"h-10 rounded-md border border-input bg-transparent px-3 text-sm",value:Se,onChange:s=>Ss(s.target.value),children:[e.jsx("option",{value:"",children:"Selecione o fornecedor"}),Ee.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]}),e.jsxs(E,{children:[e.jsx(l,{variant:"secondary",onClick:()=>Ce(!1),children:"Cancelar"}),e.jsx(l,{onClick:_a,disabled:!Se,children:"Mover"})]})]})}),e.jsx(b,{open:Sa,onOpenChange:Ne,children:e.jsxs(y,{children:[e.jsx(N,{children:e.jsx(w,{children:"Mover para fornecedor"})}),e.jsxs("select",{className:"h-10 rounded-md border border-input bg-transparent px-3 text-sm",value:Xe,onChange:s=>ws(s.target.value),children:[e.jsx("option",{value:"",children:"Selecione o fornecedor"}),Ee.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]}),e.jsxs(E,{children:[e.jsx(l,{variant:"secondary",onClick:()=>Ne(!1),children:"Cancelar"}),e.jsx(l,{onClick:async()=>{!A||!Xe||(await S(A.id,{queue:"Fornecedor",status:"Aguardando fornecedor",externalOwnerId:Xe}),Ne(!1))},children:"Mover"})]})]})}),e.jsx(b,{open:Da,onOpenChange:Ge,children:e.jsxs(y,{className:"max-w-2xl",children:[e.jsx(N,{children:e.jsx(w,{children:"Detalhe do chamado"})}),A?$s(A):null]})}),e.jsx(b,{open:Oa,onOpenChange:es,children:e.jsxs(y,{className:"max-w-xl",children:[e.jsx(N,{children:e.jsx(w,{children:"Colunas visÃ­veis"})}),e.jsxs("div",{className:"grid gap-2 text-sm text-muted-foreground",children:[e.jsx("label",{className:"text-xs text-muted-foreground",children:"Aplicar em"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx(l,{size:"sm",variant:H==="all"?"default":"outline",onClick:()=>Y("all"),children:"Todas as filas"}),e.jsx(l,{size:"sm",variant:H==="TI Interna"?"default":"outline",onClick:()=>Y("TI Interna"),children:"TI Interna"}),e.jsx(l,{size:"sm",variant:H==="Fornecedor"?"default":"outline",onClick:()=>Y("Fornecedor"),children:"Fornecedor"})]})]}),e.jsx("div",{className:"grid gap-2 text-sm text-muted-foreground",children:W.map(s=>{const a=P.find(i=>i.id===s);if(!a)return null;const n=Te.includes(a.id);return e.jsxs("div",{className:"flex items-center gap-2 rounded-md border border-border/60 bg-background/40 p-2",draggable:!0,onDragStart:i=>{i.dataTransfer.setData("text/plain",a.id)},onDragOver:i=>{i.preventDefault()},onDrop:i=>{i.preventDefault();const o=i.dataTransfer.getData("text/plain");o&&Va(o,a.id)},children:[e.jsx("span",{className:"cursor-grab select-none text-xs",children:"â‹®â‹®"}),e.jsx("input",{type:"checkbox",checked:n,disabled:a.required,onChange:()=>qa(a.id)}),e.jsxs("span",{children:[a.label,a.required?" (obrigatÃ³ria)":""]})]},a.id)})}),e.jsxs(E,{children:[e.jsx(l,{variant:"outline",onClick:ka,children:"Resetar colunas"}),e.jsx(l,{variant:"secondary",onClick:()=>es(!1),children:"Fechar"})]})]})}),e.jsx(b,{open:Na,onOpenChange:be,children:e.jsxs(y,{className:"max-w-xl",children:[e.jsx(N,{children:e.jsx(w,{children:"Respostas prontas"})}),e.jsx("div",{className:"grid gap-3 text-sm text-muted-foreground",children:f.length===0?e.jsx("p",{children:"Sem respostas cadastradas."}):f.map(s=>e.jsxs("div",{className:"rounded-md border border-border/60 bg-background/40 p-3",children:[e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-foreground",children:s.title}),e.jsx("p",{className:"text-xs text-muted-foreground",children:s.scope==="shared"?"Compartilhado":"Pessoal"})]}),e.jsx(l,{size:"sm",onClick:()=>{ve(s.id);const a=c??A;O(a?de(s.body,a):s.body),be(!1)},children:"Usar"})]}),e.jsx("p",{className:"mt-2 text-xs text-muted-foreground line-clamp-3",children:s.body})]},s.id))})]})}),e.jsx(b,{open:!!X,onOpenChange:()=>ga(null),children:e.jsxs(y,{className:"max-w-4xl",children:[e.jsx(N,{children:e.jsx(w,{children:X?.filename??"Imagem"})}),X?e.jsx("img",{src:X.url,alt:X.filename??"Imagem",className:"max-h-[70vh] w-full rounded-md object-contain"}):null]})}),e.jsx(b,{open:Ma,onOpenChange:Ae,children:e.jsxs(y,{className:"max-w-2xl",children:[e.jsx(N,{children:e.jsx(w,{children:"Novo chamado"})}),e.jsxs("div",{className:"grid gap-3 text-sm text-muted-foreground",children:[e.jsxs("div",{className:"grid gap-1",children:[e.jsx("label",{children:"Assunto *"}),e.jsx(z,{value:u.subject,onChange:s=>j(a=>({...a,subject:s.target.value})),placeholder:"Descreva o chamado"})]}),e.jsxs("div",{className:"grid gap-1",children:[e.jsx("label",{children:"DescriÃ§Ã£o"}),e.jsx(ie,{value:u.description,onChange:s=>j(a=>({...a,description:s.target.value}))})]}),e.jsxs("div",{className:"grid gap-3 lg:grid-cols-2",children:[e.jsxs("div",{className:"grid gap-1",children:[e.jsx("label",{children:"Sistema *"}),e.jsx(z,{value:u.system,onChange:s=>j(a=>({...a,system:s.target.value})),placeholder:"Ex: Sankhya"})]}),e.jsxs("div",{className:"grid gap-1",children:[e.jsx("label",{children:"Categoria *"}),e.jsx(z,{value:u.category,onChange:s=>j(a=>({...a,category:s.target.value})),placeholder:"Ex: Incidente"})]})]}),e.jsxs("div",{className:"grid gap-3 lg:grid-cols-2",children:[e.jsxs("div",{className:"grid gap-1",children:[e.jsx("label",{children:"ResponsÃ¡vel (opcional)"}),e.jsxs("select",{className:"h-10 rounded-md border border-input bg-transparent px-3 text-sm",value:V,onChange:s=>{const a=s.target.value;Ms(a);const n=zs.find(i=>i.id===a)?.name??"";j(i=>({...i,assignee:n}))},children:[e.jsx("option",{value:"",children:"NÃ£o atribuÃ­do"}),zs.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})]}),e.jsxs("div",{className:"grid gap-1",children:[e.jsx("label",{children:"Ativo relacionado"}),e.jsxs("select",{className:"h-10 rounded-md border border-input bg-transparent px-3 text-sm",value:u.relatedAssetId,onChange:s=>j(a=>({...a,relatedAssetId:s.target.value})),children:[e.jsx("option",{value:"",children:"Sem ativo"}),Rs.map(s=>e.jsx("option",{value:s.id,children:s.label},s.id))]}),V&&Me.get(V)?.length?e.jsxs("p",{className:"text-[11px] text-muted-foreground",children:["SugestÃ£o: ",Me.get(V)?.[0]?.tag]}):null]})]}),e.jsxs("div",{className:"grid gap-3 lg:grid-cols-2",children:[e.jsxs("div",{className:"grid gap-1",children:[e.jsx("label",{children:"Canal"}),e.jsx("select",{className:"h-10 rounded-md border border-input bg-transparent px-3 text-sm",value:u.channel??"Manual",onChange:s=>j(a=>({...a,channel:s.target.value})),children:["Manual","Email","Portal","Telefone","WhatsApp","Chat"].map(s=>e.jsx("option",{value:s,children:s},s))})]}),e.jsxs("div",{className:"grid gap-1",children:[e.jsx("label",{children:"Origem"}),e.jsx(z,{value:u.channel?`${u.channel} â€¢ Interno`:"Interno",disabled:!0})]})]}),e.jsxs("div",{className:"grid gap-3 lg:grid-cols-2",children:[e.jsxs("div",{className:"grid gap-1",children:[e.jsx("label",{children:"Impacto *"}),e.jsx("select",{className:"h-10 rounded-md border border-input bg-transparent px-3 text-sm",value:u.impact,onChange:s=>j(a=>({...a,impact:s.target.value})),children:["Baixo","MÃ©dio","Alto"].map(s=>e.jsx("option",{value:s,children:s},s))})]}),e.jsxs("div",{className:"grid gap-1",children:[e.jsx("label",{children:"UrgÃªncia *"}),e.jsx("select",{className:"h-10 rounded-md border border-input bg-transparent px-3 text-sm",value:u.urgency,onChange:s=>j(a=>({...a,urgency:s.target.value})),children:["Baixa","MÃ©dia","Alta"].map(s=>e.jsx("option",{value:s,children:s},s))})]})]}),e.jsxs("div",{className:"grid gap-3 lg:grid-cols-2",children:[e.jsxs("div",{className:"grid gap-1",children:[e.jsx("label",{children:"Fila *"}),e.jsx("select",{className:"h-10 rounded-md border border-input bg-transparent px-3 text-sm",value:u.queue,onChange:s=>j(a=>({...a,queue:s.target.value,externalOwnerId:s.target.value==="Fornecedor"?a.externalOwnerId:""})),children:["TI Interna","Fornecedor"].map(s=>e.jsx("option",{value:s,children:s},s))})]}),e.jsxs("div",{className:"grid gap-1",children:[e.jsxs("label",{children:["Fornecedor ",u.queue==="Fornecedor"?"*":""]}),e.jsxs("select",{className:"h-10 rounded-md border border-input bg-transparent px-3 text-sm",value:u.externalOwnerId,onChange:s=>j(a=>({...a,externalOwnerId:s.target.value})),disabled:u.queue!=="Fornecedor",children:[e.jsx("option",{value:"",children:"Selecione"}),Ee.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]})]})]})]}),e.jsxs(E,{children:[e.jsx(l,{variant:"secondary",onClick:()=>Ae(!1),children:"Cancelar"}),e.jsx(l,{onClick:async()=>{[u.subject,u.system,u.category,u.impact,u.urgency,u.queue].some(a=>!a)||u.queue==="Fornecedor"&&!u.externalOwnerId||(await Zs({subject:u.subject,description:u.description,system:u.system,category:u.category,impact:u.impact,urgency:u.urgency,queue:u.queue,channel:u.channel??"Manual",assignee:u.assignee||void 0,relatedAssetId:u.relatedAssetId||void 0,externalOwnerId:u.queue==="Fornecedor"?u.externalOwnerId:void 0,status:"Novo",openedAt:new Date}),j({subject:"",description:"",system:"",category:"",impact:"MÃ©dio",urgency:"MÃ©dia",queue:"TI Interna",externalOwnerId:"",channel:"Manual",assignee:"",relatedAssetId:""}),Ms(""),Ae(!1))},children:"Criar"})]})]})})]})]})}export{fn as Tickets};
