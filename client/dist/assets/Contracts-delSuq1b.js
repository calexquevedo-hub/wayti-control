import{r as i,j as e,C as g,h,k as m,i as p,q as j,B as c,D as C,m as f,n as y,o as D,I as l,E as w}from"./index-DESoNwQK.js";import{B as A}from"./badge-BZPWyFCa.js";const B={Active:"success",Expired:"warning",Draft:"secondary",Canceled:"outline"};function L({contracts:d,assets:v,vendors:x,onCreate:S,onUpdate:R}){const[F,o]=i.useState(!1),[I,u]=i.useState(!1),[b,V]=i.useState(null),[r,t]=i.useState({title:"",vendorId:"",status:"Active",costValue:"",currency:"BRL",frequency:"Monthly",costCenter:"",startDate:"",endDate:"",noticePeriodDays:"30",autoRenew:!1,relatedAssets:[],contractFileUrl:""}),U=a=>a?typeof a=="string"?a:a.id:"",q=a=>a?typeof a=="string"?x.find(s=>s.id===a)?.name??"Fornecedor":a.name:"Fornecedor",O=a=>a?a.map(s=>typeof s=="string"?s:s.id):[],E=i.useMemo(()=>d.filter(a=>a.status==="Active"&&a.frequency==="Monthly").reduce((a,s)=>a+(s.costValue??0),0),[d]),P=i.useMemo(()=>d.filter(a=>a.renewalStatus==="Critical"),[d]),N=(a,s)=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:s}).format(a);return e.jsxs("div",{className:"grid gap-6",children:[e.jsxs("section",{className:"grid gap-4 lg:grid-cols-2",children:[e.jsxs(g,{className:"bg-card/70",children:[e.jsxs(h,{children:[e.jsx(m,{children:"Custo Mensal Total (OpEx)"}),e.jsx(p,{children:N(E,"BRL")})]}),e.jsx(j,{className:"text-sm text-muted-foreground",children:"Contratos ativos com cobrança mensal."})]}),e.jsxs(g,{className:"bg-card/70 border-destructive/40",children:[e.jsxs(h,{children:[e.jsx(m,{children:"Contratos vencendo em 30 dias"}),e.jsx(p,{className:"text-destructive",children:P.length})]}),e.jsx(j,{className:"text-sm text-muted-foreground",children:"Itens com aviso crítico para renovação."})]})]}),e.jsxs(g,{className:"bg-card/70",children:[e.jsxs(h,{className:"flex flex-col gap-4 lg:flex-row lg:items-center lg:justify-between",children:[e.jsxs("div",{children:[e.jsx(p,{children:"Contratos e Fornecedores"}),e.jsx(m,{children:"Controle de custos e prazos."})]}),e.jsx(c,{onClick:()=>o(!0),children:"Novo contrato"})]}),e.jsx(j,{className:"space-y-3 text-sm text-muted-foreground",children:d.length===0?e.jsx("p",{children:"Nenhum contrato cadastrado."}):d.map(a=>e.jsxs("div",{className:"rounded-lg border border-border/60 bg-background/40 p-4",onClick:()=>{V(a),t({title:a.title,vendorId:U(a.vendorId),status:a.status,costValue:String(a.costValue??""),currency:a.currency,frequency:a.frequency,costCenter:a.costCenter??"",startDate:a.startDate.toISOString().slice(0,10),endDate:a.endDate?a.endDate.toISOString().slice(0,10):"",noticePeriodDays:String(a.noticePeriodDays??30),autoRenew:a.autoRenew,relatedAssets:O(a.relatedAssets),contractFileUrl:a.contractFileUrl??""}),u(!0)},children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-foreground",children:a.title}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[q(a.vendorId)," • ",a.frequency]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[a.renewalStatus==="Critical"?e.jsx(A,{variant:"warning",children:"Crítico"}):null,e.jsx(A,{variant:B[a.status],children:a.status})]})]}),e.jsxs("div",{className:"mt-2 flex flex-wrap gap-4 text-xs text-muted-foreground",children:[e.jsx("span",{children:N(a.costValue,a.currency)}),e.jsxs("span",{children:["Vence em: ",a.endDate?a.endDate.toLocaleDateString("pt-BR"):"Sem término"]}),e.jsxs("span",{children:["Auto-renovação: ",a.autoRenew?"Sim":"Não"]})]})]},a.id))})]}),e.jsx(C,{open:F,onOpenChange:o,children:e.jsxs(f,{className:"max-w-3xl",children:[e.jsx(y,{children:e.jsx(D,{children:"Novo contrato"})}),e.jsxs("div",{className:"grid gap-3 text-sm text-muted-foreground",children:[e.jsxs("div",{className:"grid gap-1",children:[e.jsx("label",{children:"Título *"}),e.jsx(l,{value:r.title,onChange:a=>t(s=>({...s,title:a.target.value}))})]}),e.jsxs("div",{className:"grid gap-1",children:[e.jsx("label",{children:"Fornecedor *"}),e.jsxs("select",{className:"h-10 rounded-md border border-input bg-transparent px-3 text-sm",value:r.vendorId,onChange:a=>t(s=>({...s,vendorId:a.target.value})),children:[e.jsx("option",{value:"",children:"Selecione"}),x.map(a=>e.jsx("option",{value:a.id,children:a.name},a.id))]})]}),e.jsxs("div",{className:"grid gap-3 lg:grid-cols-3",children:[e.jsxs("div",{className:"grid gap-1",children:[e.jsx("label",{children:"Valor *"}),e.jsx(l,{type:"number",value:r.costValue,onChange:a=>t(s=>({...s,costValue:a.target.value}))})]}),e.jsxs("div",{className:"grid gap-1",children:[e.jsx("label",{children:"Moeda"}),e.jsx("select",{className:"h-10 rounded-md border border-input bg-transparent px-3 text-sm",value:r.currency,onChange:a=>t(s=>({...s,currency:a.target.value})),children:["BRL","USD","EUR"].map(a=>e.jsx("option",{value:a,children:a},a))})]}),e.jsxs("div",{className:"grid gap-1",children:[e.jsx("label",{children:"Frequência"}),e.jsx("select",{className:"h-10 rounded-md border border-input bg-transparent px-3 text-sm",value:r.frequency,onChange:a=>t(s=>({...s,frequency:a.target.value})),children:["Monthly","Yearly","One-time"].map(a=>e.jsx("option",{value:a,children:a},a))})]})]}),e.jsxs("div",{className:"grid gap-3 lg:grid-cols-2",children:[e.jsxs("div",{className:"grid gap-1",children:[e.jsx("label",{children:"Início *"}),e.jsx(l,{type:"date",value:r.startDate,onChange:a=>t(s=>({...s,startDate:a.target.value}))})]}),e.jsxs("div",{className:"grid gap-1",children:[e.jsx("label",{children:"Fim"}),e.jsx(l,{type:"date",value:r.endDate,onChange:a=>t(s=>({...s,endDate:a.target.value}))})]})]}),e.jsxs("div",{className:"grid gap-3 lg:grid-cols-3",children:[e.jsxs("div",{className:"grid gap-1",children:[e.jsx("label",{children:"Centro de custo"}),e.jsx(l,{value:r.costCenter,onChange:a=>t(s=>({...s,costCenter:a.target.value}))})]}),e.jsxs("div",{className:"grid gap-1",children:[e.jsx("label",{children:"Aviso (dias)"}),e.jsx(l,{type:"number",value:r.noticePeriodDays,onChange:a=>t(s=>({...s,noticePeriodDays:a.target.value}))})]}),e.jsxs("div",{className:"grid gap-1",children:[e.jsx("label",{children:"Status"}),e.jsx("select",{className:"h-10 rounded-md border border-input bg-transparent px-3 text-sm",value:r.status,onChange:a=>t(s=>({...s,status:a.target.value})),children:["Active","Expired","Draft","Canceled"].map(a=>e.jsx("option",{value:a,children:a},a))})]})]}),e.jsxs("div",{className:"grid gap-1",children:[e.jsx("label",{children:"Auto-renovação"}),e.jsxs("select",{className:"h-10 rounded-md border border-input bg-transparent px-3 text-sm",value:r.autoRenew?"true":"false",onChange:a=>t(s=>({...s,autoRenew:a.target.value==="true"})),children:[e.jsx("option",{value:"true",children:"Sim"}),e.jsx("option",{value:"false",children:"Não"})]})]}),e.jsxs("div",{className:"grid gap-1",children:[e.jsx("label",{children:"Vincular ativos"}),e.jsx("select",{multiple:!0,className:"min-h-[120px] rounded-md border border-input bg-transparent px-3 text-sm",value:r.relatedAssets,onChange:a=>{const s=Array.from(a.target.selectedOptions).map(n=>n.value);t(n=>({...n,relatedAssets:s}))},children:v.map(a=>e.jsxs("option",{value:a.id,children:[a.tag," • ",a.name]},a.id))})]}),e.jsxs("div",{className:"grid gap-1",children:[e.jsx("label",{children:"Arquivo do contrato (URL)"}),e.jsx(l,{value:r.contractFileUrl,onChange:a=>t(s=>({...s,contractFileUrl:a.target.value}))})]})]}),e.jsxs(w,{children:[e.jsx(c,{variant:"secondary",onClick:()=>o(!1),children:"Cancelar"}),e.jsx(c,{onClick:async()=>{await S({title:r.title,vendorId:r.vendorId,status:r.status,costValue:Number(r.costValue),currency:r.currency,frequency:r.frequency,costCenter:r.costCenter||void 0,startDate:new Date(r.startDate),endDate:r.endDate?new Date(r.endDate):null,noticePeriodDays:Number(r.noticePeriodDays),autoRenew:r.autoRenew,relatedAssets:r.relatedAssets,contractFileUrl:r.contractFileUrl||void 0}),o(!1)},children:"Salvar"})]})]})}),e.jsx(C,{open:I,onOpenChange:u,children:e.jsxs(f,{className:"max-w-3xl",children:[e.jsx(y,{children:e.jsx(D,{children:"Editar contrato"})}),e.jsxs("div",{className:"grid gap-3 text-sm text-muted-foreground",children:[e.jsxs("div",{className:"grid gap-1",children:[e.jsx("label",{children:"Título *"}),e.jsx(l,{value:r.title,onChange:a=>t(s=>({...s,title:a.target.value}))})]}),e.jsxs("div",{className:"grid gap-1",children:[e.jsx("label",{children:"Fornecedor *"}),e.jsxs("select",{className:"h-10 rounded-md border border-input bg-transparent px-3 text-sm",value:r.vendorId,onChange:a=>t(s=>({...s,vendorId:a.target.value})),children:[e.jsx("option",{value:"",children:"Selecione"}),x.map(a=>e.jsx("option",{value:a.id,children:a.name},a.id))]})]}),e.jsxs("div",{className:"grid gap-3 lg:grid-cols-3",children:[e.jsxs("div",{className:"grid gap-1",children:[e.jsx("label",{children:"Valor *"}),e.jsx(l,{type:"number",value:r.costValue,onChange:a=>t(s=>({...s,costValue:a.target.value}))})]}),e.jsxs("div",{className:"grid gap-1",children:[e.jsx("label",{children:"Moeda"}),e.jsx("select",{className:"h-10 rounded-md border border-input bg-transparent px-3 text-sm",value:r.currency,onChange:a=>t(s=>({...s,currency:a.target.value})),children:["BRL","USD","EUR"].map(a=>e.jsx("option",{value:a,children:a},a))})]}),e.jsxs("div",{className:"grid gap-1",children:[e.jsx("label",{children:"Frequência"}),e.jsx("select",{className:"h-10 rounded-md border border-input bg-transparent px-3 text-sm",value:r.frequency,onChange:a=>t(s=>({...s,frequency:a.target.value})),children:["Monthly","Yearly","One-time"].map(a=>e.jsx("option",{value:a,children:a},a))})]})]}),e.jsxs("div",{className:"grid gap-3 lg:grid-cols-2",children:[e.jsxs("div",{className:"grid gap-1",children:[e.jsx("label",{children:"Início *"}),e.jsx(l,{type:"date",value:r.startDate,onChange:a=>t(s=>({...s,startDate:a.target.value}))})]}),e.jsxs("div",{className:"grid gap-1",children:[e.jsx("label",{children:"Fim"}),e.jsx(l,{type:"date",value:r.endDate,onChange:a=>t(s=>({...s,endDate:a.target.value}))})]})]}),e.jsxs("div",{className:"grid gap-3 lg:grid-cols-3",children:[e.jsxs("div",{className:"grid gap-1",children:[e.jsx("label",{children:"Centro de custo"}),e.jsx(l,{value:r.costCenter,onChange:a=>t(s=>({...s,costCenter:a.target.value}))})]}),e.jsxs("div",{className:"grid gap-1",children:[e.jsx("label",{children:"Aviso (dias)"}),e.jsx(l,{type:"number",value:r.noticePeriodDays,onChange:a=>t(s=>({...s,noticePeriodDays:a.target.value}))})]}),e.jsxs("div",{className:"grid gap-1",children:[e.jsx("label",{children:"Status"}),e.jsx("select",{className:"h-10 rounded-md border border-input bg-transparent px-3 text-sm",value:r.status,onChange:a=>t(s=>({...s,status:a.target.value})),children:["Active","Expired","Draft","Canceled"].map(a=>e.jsx("option",{value:a,children:a},a))})]})]}),e.jsxs("div",{className:"grid gap-1",children:[e.jsx("label",{children:"Auto-renovação"}),e.jsxs("select",{className:"h-10 rounded-md border border-input bg-transparent px-3 text-sm",value:r.autoRenew?"true":"false",onChange:a=>t(s=>({...s,autoRenew:a.target.value==="true"})),children:[e.jsx("option",{value:"true",children:"Sim"}),e.jsx("option",{value:"false",children:"Não"})]})]}),e.jsxs("div",{className:"grid gap-1",children:[e.jsx("label",{children:"Vincular ativos"}),e.jsx("select",{multiple:!0,className:"min-h-[120px] rounded-md border border-input bg-transparent px-3 text-sm",value:r.relatedAssets,onChange:a=>{const s=Array.from(a.target.selectedOptions).map(n=>n.value);t(n=>({...n,relatedAssets:s}))},children:v.map(a=>e.jsxs("option",{value:a.id,children:[a.tag," • ",a.name]},a.id))})]}),e.jsxs("div",{className:"grid gap-1",children:[e.jsx("label",{children:"Arquivo do contrato (URL)"}),e.jsx(l,{value:r.contractFileUrl,onChange:a=>t(s=>({...s,contractFileUrl:a.target.value}))})]})]}),e.jsxs(w,{children:[e.jsx(c,{variant:"secondary",onClick:()=>u(!1),children:"Cancelar"}),e.jsx(c,{onClick:async()=>{b&&(await R(b.id,{title:r.title,vendorId:r.vendorId,status:r.status,costValue:Number(r.costValue),currency:r.currency,frequency:r.frequency,costCenter:r.costCenter||void 0,startDate:new Date(r.startDate),endDate:r.endDate?new Date(r.endDate):null,noticePeriodDays:Number(r.noticePeriodDays),autoRenew:r.autoRenew,relatedAssets:r.relatedAssets,contractFileUrl:r.contractFileUrl||void 0}),u(!1))},children:"Salvar alterações"})]})]})})]})}export{L as Contracts};
