import{c as N,r as x,F as y,G as R,H as S,j as e,C as m,h as p,i as u,k as h,q as g,B as j,J as w}from"./index-DESoNwQK.js";const v=N("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);function b(n){return new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(n)}function A(n,i){const t=[];t.push("Relatório Executivo"),t.push("Período,Orçamento Total,Gasto Real,Projetos em Risco,Entregas no Prazo"),i.forEach(a=>{t.push([a.period,a.totalBudget,a.totalSpent,a.riskCount,`${a.onTimePercentage}%`].join(","))}),t.push(""),t.push("Demandas"),t.push("ID,Nome,Tipo,Status,Patrocinador,Orçamento,Gasto,Progresso,Última Atualização"),n.forEach(a=>{t.push([a.id,a.name,a.type,a.status,a.sponsor,a.budget,a.spent,`${a.progress}%`,a.lastUpdate.toISOString().slice(0,10)].join(","))});const o=new Blob([t.join(`
`)],{type:"text/csv;charset=utf-8;"}),c=URL.createObjectURL(o),r=document.createElement("a");r.href=c,r.download=`relatorio-ti-${new Date().toISOString().slice(0,10)}.csv`,document.body.appendChild(r),r.click(),r.remove(),URL.revokeObjectURL(c)}function k(n,i){const t=window.open("","_blank","width=900,height=700");if(!t)return;const o=i[0],c=n.map(r=>`
        <tr>
          <td>${r.id}</td>
          <td>${r.name}</td>
          <td>${r.type}</td>
          <td>${r.status}</td>
          <td>${r.sponsor}</td>
          <td>${b(r.budget)}</td>
          <td>${b(r.spent)}</td>
          <td>${r.progress}%</td>
          <td>${r.lastUpdate.toLocaleDateString("pt-BR")}</td>
        </tr>
      `).join("");t.document.write(`
    <html>
      <head>
        <title>Relatório TI</title>
        <style>
          body { font-family: Arial, sans-serif; padding: 32px; color: #0f172a; }
          h1 { margin: 0 0 8px; }
          .subtitle { color: #475569; margin-bottom: 24px; }
          .summary { display: grid; grid-template-columns: repeat(2, minmax(0, 1fr)); gap: 12px; margin-bottom: 24px; }
          .card { border: 1px solid #e2e8f0; padding: 12px; border-radius: 8px; }
          table { width: 100%; border-collapse: collapse; }
          th, td { border: 1px solid #e2e8f0; padding: 8px; font-size: 12px; }
          th { background: #f1f5f9; text-align: left; }
        </style>
      </head>
      <body>
        <h1>Relatório Executivo de Demandas TI</h1>
        <div class="subtitle">Gerado em ${new Date().toLocaleDateString("pt-BR")}</div>
        <div class="summary">
          <div class="card">Orçamento Total: ${b(o?.totalBudget??0)}</div>
          <div class="card">Gasto Real: ${b(o?.totalSpent??0)}</div>
          <div class="card">Projetos em Risco: ${o?.riskCount??0}</div>
          <div class="card">Entregas no Prazo: ${o?.onTimePercentage??0}%</div>
        </div>
        <table>
          <thead>
            <tr>
              <th>ID</th>
              <th>Nome</th>
              <th>Tipo</th>
              <th>Status</th>
              <th>Patrocinador</th>
              <th>Orçamento</th>
              <th>Gasto</th>
              <th>Progresso</th>
              <th>Atualização</th>
            </tr>
          </thead>
          <tbody>
            ${c}
          </tbody>
        </table>
      </body>
    </html>
  `),t.document.close(),t.focus(),t.print()}function L({reportSnapshots:n,demands:i=[],token:t}){const[o,c]=x.useState(null),[r,a]=x.useState(null),[l,f]=x.useState(null);return x.useEffect(()=>{t&&y(t).then(s=>c(s)).catch(()=>c(null))},[t]),x.useEffect(()=>{t&&R(t).then(s=>a(s)).catch(()=>a(null))},[t]),x.useEffect(()=>{t&&S(t).then(s=>f(s)).catch(()=>f(null))},[t]),e.jsxs("div",{className:"grid gap-6 lg:grid-cols-2",children:[e.jsxs(m,{className:"bg-card/70",children:[e.jsxs(p,{children:[e.jsx(u,{children:"Resumo Executivo"}),e.jsx(h,{children:"Indicadores consolidados para alta gestão."})]}),e.jsxs(g,{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs(j,{variant:"outline",className:"gap-2",onClick:()=>A(i,n),children:[e.jsx(v,{className:"h-4 w-4"}),"Exportar CSV"]}),e.jsxs(j,{className:"gap-2",onClick:()=>k(i,n),children:[e.jsx(w,{className:"h-4 w-4"}),"Exportar PDF"]})]}),n.map(s=>e.jsxs("div",{className:"rounded-lg border border-border/60 bg-background/40 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"text-sm font-semibold",children:s.period}),e.jsxs(j,{variant:"outline",size:"sm",className:"gap-2",children:[e.jsx(v,{className:"h-4 w-4"}),"Exportar"]})]}),e.jsxs("div",{className:"mt-3 grid gap-2 text-xs text-muted-foreground",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Orçamento total"}),e.jsxs("span",{children:["R$ ",s.totalBudget.toLocaleString("pt-BR")]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Gasto real"}),e.jsxs("span",{children:["R$ ",s.totalSpent.toLocaleString("pt-BR")]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Projetos em risco"}),e.jsx("span",{children:s.riskCount})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{children:"Entregas no prazo"}),e.jsxs("span",{children:[s.onTimePercentage,"%"]})]})]})]},s.period))]})]}),e.jsxs(m,{className:"bg-card/70",children:[e.jsxs(p,{children:[e.jsx(u,{children:"Visão Executiva"}),e.jsx(h,{children:"Dados reais do backend para alta gestão."})]}),e.jsxs(g,{className:"space-y-4 text-sm text-muted-foreground",children:[o?null:e.jsx("p",{children:"Nenhum dado executivo carregado."}),o?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"rounded-lg border border-border/60 bg-background/40 p-4",children:[e.jsx("p",{className:"text-sm font-semibold text-foreground",children:"Financeiro consolidado"}),e.jsxs("p",{children:["Total mensal: R$ ",o.totalMonthly.toLocaleString("pt-BR")]}),e.jsxs("p",{children:["Total one-off: R$ ",o.totalOneOff.toLocaleString("pt-BR")]})]}),e.jsxs("div",{className:"rounded-lg border border-border/60 bg-background/40 p-4",children:[e.jsx("p",{className:"text-sm font-semibold text-foreground",children:"Itens por status"}),Object.entries(o.statusCounts).map(([s,d])=>e.jsxs("p",{children:[s,": ",d]},s))]}),e.jsxs("div",{className:"rounded-lg border border-border/60 bg-background/40 p-4",children:[e.jsx("p",{className:"text-sm font-semibold text-foreground",children:"Aging buckets"}),Object.entries(o.agingBuckets).map(([s,d])=>e.jsxs("p",{children:[s," dias: ",d]},s))]}),e.jsxs("div",{className:"rounded-lg border border-border/60 bg-background/40 p-4",children:[e.jsx("p",{className:"text-sm font-semibold text-foreground",children:"P0 + Overdue"}),o.p0AndOverdue.length===0?e.jsx("p",{children:"Nenhum item crítico."}):o.p0AndOverdue.map(s=>e.jsxs("p",{children:[s.priority," • ",s.name]},s.id))]}),e.jsxs("div",{className:"rounded-lg border border-border/60 bg-background/40 p-4",children:[e.jsx("p",{className:"text-sm font-semibold text-foreground",children:"Aguardando terceiros"}),o.topWaiting.length===0?e.jsx("p",{children:"Nenhuma demanda aguardando terceiros."}):o.topWaiting.map(s=>e.jsxs("p",{children:[s.priority," • ",s.name]},s.id))]})]}):null]})]}),e.jsxs(m,{className:"bg-card/70 lg:col-span-2",children:[e.jsxs(p,{children:[e.jsx(u,{children:"Tickets Executivos"}),e.jsx(h,{children:"Tickets vinculados a demandas P0 em aberto."})]}),e.jsxs(g,{className:"space-y-4 text-sm text-muted-foreground",children:[r?null:e.jsx("p",{children:"Nenhum ticket executivo carregado."}),r?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsxs("div",{className:"rounded-full border border-border/60 bg-background/40 px-3 py-1 text-xs",children:["Total: ",r.total]}),e.jsxs("div",{className:"rounded-full border border-amber-500/40 bg-amber-500/10 px-3 py-1 text-xs text-amber-200",children:["SLA estourado: ",r.overdueCount]}),Object.entries(r.overdueByQueue).map(([s,d])=>e.jsxs("div",{className:"rounded-full border border-border/60 bg-background/40 px-3 py-1 text-xs",children:[s,": ",d]},s))]}),r.tickets.length===0?e.jsx("p",{children:"Nenhum ticket executivo encontrado."}):r.tickets.map(s=>e.jsxs("div",{className:"rounded-lg border border-border/60 bg-background/40 p-4",children:[e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-2",children:[e.jsx("p",{className:"text-sm font-semibold",children:s.subject}),e.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[e.jsx("span",{className:"rounded-full bg-muted px-2 py-0.5",children:s.system}),s.isSlaOverdue?e.jsx("span",{className:"rounded-full bg-amber-500/20 px-2 py-0.5 text-amber-200",children:"SLA estourado"}):null]})]}),e.jsxs("div",{className:"mt-2 grid gap-1 text-xs",children:[e.jsxs("p",{children:["Demanda: ",s.demandId.name," • Épico: ",s.demandId.epic," • Status:"," ",s.demandId.status]}),e.jsxs("p",{children:["Próximo follow-up:"," ",s.demandId.nextFollowUpAt?s.demandId.nextFollowUpAt.toLocaleDateString("pt-BR"):"-"]}),e.jsxs("p",{children:["Aberto em ",s.openedAt.toLocaleDateString("pt-BR")," • SLA vence em"," ",s.slaDueAt?s.slaDueAt.toLocaleDateString("pt-BR"):"-"]})]})]},s._id)),e.jsxs("div",{className:"grid gap-3 lg:grid-cols-2",children:[e.jsxs("div",{className:"rounded-lg border border-border/60 bg-background/40 p-4",children:[e.jsx("p",{className:"text-sm font-semibold text-foreground",children:"Tickets por status"}),Object.entries(r.statusCounts).map(([s,d])=>e.jsxs("p",{className:"text-xs",children:[s,": ",d]},s))]}),e.jsxs("div",{className:"rounded-lg border border-border/60 bg-background/40 p-4",children:[e.jsx("p",{className:"text-sm font-semibold text-foreground",children:"Aging buckets"}),Object.entries(r.agingBuckets).map(([s,d])=>e.jsxs("p",{className:"text-xs",children:[s," dias: ",d]},s))]})]})]}):null]})]}),e.jsxs(m,{className:"bg-card/70 lg:col-span-2",children:[e.jsxs(p,{children:[e.jsx(u,{children:"Dashboard de SLA"}),e.jsx(h,{children:"Indicadores de SLA por fila e responsável."})]}),e.jsxs(g,{className:"space-y-4 text-sm text-muted-foreground",children:[l?null:e.jsx("p",{children:"Nenhum dado de SLA carregado."}),l?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid gap-3 lg:grid-cols-4",children:[e.jsxs("div",{className:"rounded-lg border border-border/60 bg-background/40 p-3",children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Abertos"}),e.jsx("p",{className:"text-lg font-semibold text-foreground",children:l.totals.open})]}),e.jsxs("div",{className:"rounded-lg border border-amber-500/40 bg-amber-500/10 p-3",children:[e.jsx("p",{className:"text-xs text-amber-200",children:"SLA estourado"}),e.jsx("p",{className:"text-lg font-semibold text-amber-100",children:l.totals.overdue})]}),e.jsxs("div",{className:"rounded-lg border border-orange-500/40 bg-orange-500/10 p-3",children:[e.jsxs("p",{className:"text-xs text-orange-200",children:["Vence em ",l.warnMinutes," min"]}),e.jsx("p",{className:"text-lg font-semibold text-orange-100",children:l.totals.warning})]}),e.jsxs("div",{className:"rounded-lg border border-blue-500/40 bg-blue-500/10 p-3",children:[e.jsx("p",{className:"text-xs text-blue-100",children:"Risco 48h"}),e.jsx("p",{className:"text-lg font-semibold text-blue-50",children:l.totals.risk48h})]})]}),e.jsxs("div",{className:"grid gap-3 lg:grid-cols-2",children:[e.jsxs("div",{className:"rounded-lg border border-border/60 bg-background/40 p-4",children:[e.jsx("p",{className:"text-sm font-semibold text-foreground",children:"SLA por fila"}),Object.entries(l.byQueue).map(([s,d])=>e.jsxs("div",{className:"mt-2 text-xs text-muted-foreground",children:[e.jsx("p",{className:"font-medium text-foreground",children:s}),e.jsxs("p",{children:["Abertos: ",d.open]}),e.jsxs("p",{children:["Estourado: ",d.overdue]}),e.jsxs("p",{children:["Vence em breve: ",d.warning]})]},s))]}),e.jsxs("div",{className:"rounded-lg border border-border/60 bg-background/40 p-4",children:[e.jsx("p",{className:"text-sm font-semibold text-foreground",children:"SLA por responsável"}),Object.entries(l.byAssignee).map(([s,d])=>e.jsxs("div",{className:"mt-2 text-xs text-muted-foreground",children:[e.jsx("p",{className:"font-medium text-foreground",children:s}),e.jsxs("p",{children:["Abertos: ",d.open]}),e.jsxs("p",{children:["Estourado: ",d.overdue]}),e.jsxs("p",{children:["Vence em breve: ",d.warning]})]},s))]})]}),e.jsxs("div",{className:"rounded-lg border border-border/60 bg-background/40 p-4",children:[e.jsx("p",{className:"text-sm font-semibold text-foreground",children:"Aging de chamados"}),Object.entries(l.agingBuckets).map(([s,d])=>e.jsxs("p",{className:"text-xs",children:[s," dias: ",d]},s))]})]}):null]})]})]})}export{L as Reports};
